<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apache DataFusion 40.0.0 Released - Apache DataFusion Blog</title>
<link href="/css/bootstrap.min.css" rel="stylesheet">
<link href="/css/fontawesome.all.min.css" rel="stylesheet">
<link href="/css/headerlink.css" rel="stylesheet">
<link href="/highlight/default.min.css" rel="stylesheet">
<script src="/highlight/highlight.js"></script>
<script>hljs.highlightAll();</script>  </head>
  <body class="d-flex flex-column h-100">
  <main class="flex-shrink-0">
<!-- nav bar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark" aria-label="Fifth navbar example">
    <div class="container-fluid">
        <a class="navbar-brand" href="/"><img src="/images/logo_original4x.png" style="height: 32px;"/> Apache DataFusion Blog</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarADP" aria-controls="navbarADP" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarADP">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link" href="/about.html">About</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/blog/feed.xml">RSS</a>
                </li>
            </ul>
        </div>
    </div>
</nav>    


<!-- page contents -->
<div id="contents">
    <div class="bg-white p-5 rounded">
        <div class="col-sm-8 mx-auto">
          <h1>
              Apache DataFusion 40.0.0 Released
          </h1>
              <p>Posted on: Wed 24 July 2024 by pmc</p>
              <!--
{% comment %}
Licensed to the Apache Software Foundation (ASF) under one or more
contributor license agreements.  See the NOTICE file distributed with
this work for additional information regarding copyright ownership.
The ASF licenses this file to you under the Apache License, Version 2.0
(the "License"); you may not use this file except in compliance with
the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
{% endcomment %}
-->
<!-- see https://github.com/apache/datafusion/issues/9602 for details -->
<h2>Introduction</h2>
<p>We are proud to announce <a href="https://crates.io/crates/datafusion/40.0.0">DataFusion 40.0.0</a>. This blog highlights some of the
many major improvements since we released <a href="https://datafusion.apache.org/blog/2024/01/19/datafusion-34.0.0/">DataFusion 34.0.0</a> and a preview of
what the community is thinking about in the next 6 months. We are hoping to make
more regular blog posts -- if you are interested in helping write them, please
reach out!</p>
<p><a href="https://datafusion.apache.org/">Apache DataFusion</a> is an extensible query engine, written in <a href="https://www.rust-lang.org/">Rust</a>, that
uses <a href="https://arrow.apache.org">Apache Arrow</a> as its in-memory format. DataFusion is used by developers to
create new, fast data centric systems such as databases, dataframe libraries,
machine learning and streaming applications. While <a href="https://datafusion.apache.org/user-guide/introduction.html#project-goals">DataFusion&rsquo;s primary design
goal</a> is to accelerate the creation of other data centric systems, it has a
reasonable experience directly out of the box as a <a href="https://datafusion.apache.org/python/">dataframe library</a> and
<a href="https://datafusion.apache.org/user-guide/cli/">command line SQL tool</a>.</p>
<p>DataFusion's core thesis is that as a community, together we can build much more
advanced technology than any of us as individuals or companies could do alone. 
Without DataFusion, highly performant vectorized query engines would remain
the domain of a few large companies and world-class research institutions. 
With DataFusion, we can all build on top of a shared foundation, and focus on
what makes our projects unique.</p>
<h2>Community Growth  📈</h2>
<p>In the last 6 months, between <code>34.0.0</code> and <code>40.0.0</code>, our community continues to
grow in new and exciting ways.</p>
<ol>
<li>DataFusion became a top level Apache Software Foundation project (read the
   <a href="https://news.apache.org/foundation/entry/apache-software-foundation-announces-new-top-level-project-apache-datafusion">press release</a> and <a href="https://datafusion.apache.org/blog/2024/05/07/datafusion-tlp/">blog post</a>).</li>
<li>We added several PMC members and new
   committers: <a href="https://github.com/comphead">@comphead</a>, <a href="https://github.com/mustafasrepo">@mustafasrepo</a>, <a href="https://github.com/ozankabak">@ozankabak</a>, and <a href="https://github.com/waynexia">@waynexia</a> joined the PMC,
   <a href="https://github.com/jonahgao">@jonahgao</a> and <a href="https://github.com/lewiszlw">@lewiszlw</a> joined as committers. See the <a href="https://lists.apache.org/list.html?dev@datafusion.apache.org">mailing list</a> for
   more details.</li>
<li><a href="https://datafusion.apache.org/comet/">DataFusion Comet</a> was <a href="https://arrow.apache.org/blog/2024/03/06/comet-donation/">donated</a> and is nearing its first release.</li>
<li>In the <a href="https://github.com/apache/arrow-datafusion">core DataFusion repo</a> alone we reviewed and accepted almost 1500 PRs from 182 different
   committers, created over 1000 issues and closed 781 of them 🚀. This is up
   almost 50% from our last post (1000 PRs from 124 committers with 650 issues
   created in our last post) 🤯. All changes are listed in the detailed
   <a href="https://github.com/apache/datafusion/blob/main/datafusion/CHANGELOG.md">CHANGELOG</a>.</li>
<li>DataFusion focused meetups happened or are happening in multiple cities 
   around the world: <a href="https://github.com/apache/datafusion/discussions/8522">Austin</a>, <a href="https://github.com/apache/datafusion/discussions/10800">San Francisco</a>, <a href="https://www.huodongxing.com/event/5761971909400?td=1965290734055">Hangzhou</a>, <a href="https://github.com/apache/datafusion/discussions/11213">New York</a>, and
   <a href="https://github.com/apache/datafusion/discussions/11431">Belgrade</a>.</li>
<li>Many new projects started in the <a href="https://github.com/datafusion-contrib">datafusion-contrib</a> organization, including
   <a href="https://github.com/datafusion-contrib/datafusion-table-providers">Table Providers</a>, <a href="https://github.com/datafusion-contrib/datafusion-sqlancer">SQLancer</a>, <a href="https://github.com/datafusion-contrib/datafusion-functions-variant">Open Variant</a>, <a href="https://github.com/datafusion-contrib/datafusion-functions-json">JSON</a>, and <a href="https://github.com/datafusion-contrib/datafusion-orc">ORC</a>.  </li>
</ol>
<!--
$ git log --pretty=oneline 34.0.0..40.0.0 . | wc -l
     1453 (up from 1009)

$ git shortlog -sn 34.0.0..40.0.0 . | wc -l
      182 (up from 124)

https://crates.io/crates/datafusion/34.0.0
DataFusion 34 released Dec 17, 2023

https://crates.io/crates/datafusion/40.0.0
DataFusion 34 released July 12, 2024

Issues created in this time: 321 open, 781 closed (up from 214 open, 437 closed)
https://github.com/apache/arrow-datafusion/issues?q=is%3Aissue+created%3A2023-12-17..2024-07-12

Issues closed: 911 (up from 517)
https://github.com/apache/arrow-datafusion/issues?q=is%3Aissue+closed%3A2023-12-17..2024-07-12

PRs merged in this time 1490 (up from 908)
https://github.com/apache/arrow-datafusion/pulls?q=is%3Apr+merged%3A2023-12-17..2024-07-12

-->
<p>In addition, DataFusion has been appearing publicly more and more, both online and offline. Here are some highlights:</p>
<ol>
<li><a href="https://dl.acm.org/doi/10.1145/3626246.3653368">Apache Arrow DataFusion: A Fast, Embeddable, Modular Analytic Query Engine</a>, was presented in <a href="https://2024.sigmod.org/">SIGMOD '24</a>, one of the major database conferences</li>
<li>As part of the trend to define "the POSIX of databases" in <a href="https://db.cs.cmu.edu/papers/2024/whatgoesaround-sigmodrec2024.pdf">"What Goes Around Comes Around... And Around..."</a> from Andy Pavlo and Mike Stonebraker</li>
<li><a href="https://www.cpard.xyz/posts/datafusion/">"Why you should keep an eye on Apache DataFusion and its community"</a></li>
<li><a href="https://www.tisonkun.org/2024/07/15/datafusion-meetup-san-francisco/">Apache DataFusion offline meetup in the Bay Area</a></li>
</ol>
<h2>Improved Performance 🚀</h2>
<p>Performance is a key feature of DataFusion, and the community continues to work
to keep DataFusion state of the art in this area. One major area DataFusion
improved is the time it takes to convert a SQL query into a plan that can be
executed. Planning is now almost 2x faster for TPC-DS and TPC-H queries, and
over 10x faster for some queries with many columns.</p>
<p>Here is a chart showing the improvement due to the concerted effort of many
contributors including <a href="https://github.com/jackwener">@jackwener</a>, <a href="https://github.com/alamb">@alamb</a>, <a href="https://github.com/Lordworms">@Lordworms</a>, <a href="https://github.com/dmitrybugakov">@dmitrybugakov</a>,
<a href="https://github.com/appletreeisyellow">@appletreeisyellow</a>, <a href="https://github.com/ClSlaid">@ClSlaid</a>, <a href="https://github.com/rohitrastogi">@rohitrastogi</a>, <a href="https://github.com/emgeee">@emgeee</a>, <a href="https://github.com/kevinmingtarja">@kevinmingtarja</a>,
and <a href="https://github.com/peter-toth">@peter-toth</a> over several months (see <a href="https://github.com/apache/arrow-datafusion/issues/8045">ticket</a> for more details)</p>
<p><img src="../images/datafusion-40.0.0/improved-planning-time.png" width="700"/></p>
<p>DataFusion is now up to 40% faster for queries that <code>GROUP BY</code> a single string
or binary column due to a <a href="https://github.com/apache/datafusion/pull/8827">specialization for single
Uft8/LargeUtf8/Binary/LargeBinary</a>. We are working on improving performance when
there are [multiple variable length columns in the <code>GROUP BY</code> clause].</p>
<p>We are also in the final phases of <a href="https://github.com/apache/datafusion/issues/10918">integrating</a> the new <a href="https://docs.rs/arrow/latest/arrow/array/struct.GenericByteViewArray.html">Arrow StringView</a>
which significantly improves performance for workloads that scan, filter and
group by variable length string and binary data. We expect the improvement to be
especially pronounced for Parquet files due to <a href="https://github.com/apache/arrow-rs/issues/5530">upstream work in the parquet
reader</a>. Kudos to <a href="https://github.com/XiangpengHong">@XiangpengHong</a>, <a href="https://github.com/AriesDevil">@AriesDevil</a>, <a href="https://github.com/PsiACE">@PsiACE</a>, <a href="https://github.com/Weijun-H">@Weijun-H</a>,
<a href="https://github.com/a10y">@a10y</a>, and <a href="https://github.com/RinChanNOWWW">@RinChanNOWWW</a> for driving this project.</p>
<h2>Improved Quality 📋</h2>
<p>DataFusion continues to improve overall in quality. In addition to ongoing bug
fixes, one of the most exciting improvements is the addition of a new <a href="https://github.com/datafusion-contrib/datafusion-sqlancer">SQLancer</a>
based <a href="https://github.com/apache/datafusion/issues/11030">DataFusion Fuzzing</a> suite thanks to <a href="https://github.com/2010YOUY01">@2010YOUY01</a> that has already found
several bugs and thanks to <a href="https://github.com/jonahgao">@jonahgao</a>, <a href="https://github.com/tshauck">@tshauck</a>, <a href="https://github.com/xinlifoobar">@xinlifoobar</a>,
<a href="https://github.com/LorrensP-2158466">@LorrensP-2158466</a> for fixing them so fast.</p>
<h2>Improved Documentation 📚</h2>
<p>We continue to improve the documentation to make it easier to get started using DataFusion with
the <a href="https://datafusion.apache.org/library-user-guide/index.html">Library Users Guide</a>, <a href="https://docs.rs/datafusion/latest/datafusion/index.html">API documentation</a>, and <a href="https://github.com/apache/datafusion/tree/main/datafusion-examples">Examples</a>.</p>
<p>Some notable new examples include:
* <a href="https://github.com/apache/datafusion/blob/main/datafusion-examples/examples/sql_analysis.rs">sql_analysis.rs</a> to analyse SQL queries with DataFusion structures (thanks <a href="https://github.com/LorrensP-2158466">@LorrensP-2158466</a>)
* <a href="https://github.com/apache/datafusion/blob/main/datafusion-examples/examples/function_factory.rs">function_factory.rs</a> to create custom functions via SQL (thanks <a href="https://github.com/milenkovicm">@milenkovicm</a>)
* <a href="https://github.com/apache/datafusion/blob/main/datafusion-examples/examples/plan_to_sql.rs">plan_to_sql.rs</a> to generate SQL from DataFusion Expr and LogicalPlan (thanks <a href="https://github.com/edmondop">@edmondop</a>)
* <a href="https://github.com/apache/datafusion/blob/main/datafusion-examples/examples/parquet_index.rs">parquet_index.rs</a> and <a href="https://github.com/apache/datafusion/blob/main/datafusion-examples/examples/advanced_parquet_index.rs">advanced_parquet_index.rs</a> for parquet indexing, described more below (thanks <a href="https://github.com/alamb">@alamb</a>)</p>
<h2>New Features ✨</h2>
<p>There are too many new features in the last 6 months to list them all, but here
are some highlights:</p>
<h1>SQL</h1>
<ul>
<li>Support for <code>UNNEST</code> (thanks <a href="https://github.com/duongcongtoai">@duongcongtoai</a>, <a href="https://github.com/JasonLi-cn">@JasonLi-cn</a> and <a href="https://github.com/jayzhan211">@jayzhan211</a>) </li>
<li>Support for <a href="https://github.com/apache/datafusion/issues/462">Recursive CTEs</a> (thanks <a href="https://github.com/jonahgao">@jonahgao</a> and <a href="https://github.com/matthewgapp">@matthewgapp</a>) </li>
<li>Support for <code>CREATE FUNCTION</code> (see below) </li>
<li>Many new SQL functions</li>
</ul>
<p>DataFusion now has much improved support for structured types such <code>STRUCT</code>,
<code>LIST</code>/<code>ARRAY</code> and <code>MAP</code>. For example, you can now create <code>STRUCT</code> literals 
in SQL like this:</p>
<div class="codehilite"><pre><span></span><code><span class="o">&gt;</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="p">{</span><span class="na">'foo</span><span class="err">'</span>: <span class="p">{</span><span class="na">'bar</span><span class="err">'</span>: <span class="mi">2</span><span class="p">}};</span><span class="w"></span>
<span class="o">+--------------------------------------------------------------+</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">named_struct</span><span class="p">(</span><span class="n">Utf8</span><span class="p">(</span><span class="s">"foo"</span><span class="p">),</span><span class="n">named_struct</span><span class="p">(</span><span class="n">Utf8</span><span class="p">(</span><span class="s">"bar"</span><span class="p">),</span><span class="n">Int64</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">+--------------------------------------------------------------+</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="n">foo</span>: <span class="p">{</span><span class="n">bar</span>: <span class="mi">2</span><span class="p">}}</span><span class="w">                                              </span><span class="o">|</span><span class="w"></span>
<span class="o">+--------------------------------------------------------------+</span><span class="w"></span>
<span class="mi">1</span><span class="w"> </span><span class="n">row</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">fetched</span><span class="p">.</span><span class="w"></span>
<span class="n">Elapsed</span><span class="w"> </span><span class="mf">0.002</span><span class="w"> </span><span class="n">seconds</span><span class="p">.</span><span class="w"></span>
</code></pre></div>
<h1>SQL Unparser (SQL Formatter)</h1>
<p>DataFusion now supports converting <code>Expr</code>s and <code>LogicalPlan</code>s BACK to SQL text.
This can be useful in query federation to push predicates down into other
systems that only accept SQL, and for building systems that generate SQL.</p>
<p>For example, you can now convert a logical expression back to SQL text:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Form a logical expression that represents the SQL "a &lt; 5 OR a = 8"</span>
<span class="kd">let</span><span class="w"> </span><span class="n">expr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col</span><span class="p">(</span><span class="s">"a"</span><span class="p">).</span><span class="n">lt</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">5</span><span class="p">)).</span><span class="n">or</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s">"a"</span><span class="p">).</span><span class="n">eq</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">8</span><span class="p">)));</span><span class="w"></span>
<span class="c1">// convert the expression back to SQL text</span>
<span class="kd">let</span><span class="w"> </span><span class="n">sql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">expr_to_sql</span><span class="p">(</span><span class="o">&amp;</span><span class="n">expr</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="n">to_string</span><span class="p">();</span><span class="w"></span>
<span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span><span class="w"> </span><span class="s">"a &lt; 5 OR a = 8"</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>You can also do complex things like parsing SQL, modifying the plan, and convert
it back to SQL:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctx</span><span class="w"></span>
<span class="w">  </span><span class="c1">// Use SQL to read some data from the parquet file</span>
<span class="w">  </span><span class="p">.</span><span class="n">sql</span><span class="p">(</span><span class="s">"SELECT int_col, double_col, CAST(date_string_col as VARCHAR) FROM alltypes_plain"</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="p">.</span><span class="k">await</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<span class="c1">// Programmatically add new filters `id &gt; 1 and tinyint_col &lt; double_col`</span>
<span class="kd">let</span><span class="w"> </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s">"id"</span><span class="p">).</span><span class="n">gt</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">)).</span><span class="n">and</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s">"tinyint_col"</span><span class="p">).</span><span class="n">lt</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s">"double_col"</span><span class="p">))))</span><span class="o">?</span><span class="w"></span>
<span class="c1">// Convert the new logical plan back to SQL</span>
<span class="kd">let</span><span class="w"> </span><span class="n">sql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plan_to_sql</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">logical_plan</span><span class="p">())</span><span class="o">?</span><span class="p">.</span><span class="n">to_string</span><span class="p">();</span><span class="w"></span>
<span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span><span class="w"> </span>
<span class="w">           </span><span class="s">"SELECT alltypes_plain.int_col, alltypes_plain.double_col, CAST(alltypes_plain.date_string_col AS VARCHAR) \</span>
<span class="s">           FROM alltypes_plain WHERE ((alltypes_plain.id &gt; 1) AND (alltypes_plain.tinyint_col &lt; alltypes_plain.double_col))"</span><span class="p">)</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>See the <a href="https://github.com/apache/datafusion/blob/main/datafusion-examples/examples/plan_to_sql.rs">Plan to SQL example</a> or the APIs <a href="https://docs.rs/datafusion/latest/datafusion/sql/unparser/fn.expr_to_sql.html">expr_to_sql</a> and <a href="https://docs.rs/datafusion/latest/datafusion/sql/unparser/fn.plan_to_sql.html">plan_to_sql</a> for more details.</p>
<h1>Low Level APIs for Fast Parquet Access (indexing)</h1>
<p>With their rising prevalence, supporting efficient access to Parquet files
stored remotely on object storage is important. Part of doing this efficiently
is minimizing the number of object store requests made by caching metadata and
skipping over parts of the file that are not needed (e.g. via an index).</p>
<p>DataFusion's Parquet reader has long internally supported <a href="https://arrow.apache.org/blog/2022/12/26/querying-parquet-with-millisecond-latency/">advanced predicate
pushdown</a> by reading the parquet metadata from the file footer and pruning based
on row group and data page statistics. DataFusion now also supports users
supplying their own low level pruning information via the [<code>ParquetAccessPlan</code>]
API.</p>
<p>This API can be used along with index information to selectively skip decoding
parts of the file. For example, Spice AI used this feature to add <a href="https://github.com/spiceai/spiceai/pull/1891">efficient
support</a> for reading from DeltaLake tables and handling <a href="https://docs.delta.io/latest/delta-deletion-vectors.html">deletion vectors</a>.</p>
<div class="codehilite"><pre><span></span><code>        &boxdr;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxdl;   If the RowSelection does not include any
        &boxv;          ...          &boxv;   rows from a particular Data Page, that
        &boxv;                       &boxv;   Data Page is not fetched or decoded.
        &boxv; &boxdr;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxdl; &boxv;   Note this requires a PageIndex
        &boxv; &boxv;     &boxdr;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxdl;  &boxv; &boxv;
Row     &boxv; &boxv;     &boxv;DataPage 0&boxv;  &boxv; &boxv;                 &boxdr;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxdl;
Groups  &boxv; &boxv;     &boxur;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxul;  &boxv; &boxv;                 &boxv;                    &boxv;
        &boxv; &boxv;     &boxdr;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxdl;  &boxv; &boxv;                 &boxv;    ParquetExec     &boxv;
        &boxv; &boxv; ... &boxv;DataPage 1&boxv; ◀&boxvh; &boxvh; &boxh; &boxh; &boxh;           &boxv;  (Parquet Reader)  &boxv;
        &boxv; &boxv;     &boxur;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxul;  &boxv; &boxv;      &boxur; &boxh; &boxh; &boxh; &boxh; &boxh;&boxv;                    &boxv;
        &boxv; &boxv;     &boxdr;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxdl;  &boxv; &boxv;                 &boxv; &boxDR;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxDL;  &boxv;
        &boxv; &boxv;     &boxv;DataPage 2&boxv;  &boxv; &boxv; If only rows    &boxv; &boxV;ParquetMetadata&boxV;  &boxv;
        &boxv; &boxv;     &boxur;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxul;  &boxv; &boxv; from DataPage 1 &boxv; &boxUR;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxUL;  &boxv;
        &boxv; &boxur;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxul; &boxv; are selected,   &boxur;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxul;
        &boxv;                       &boxv; only DataPage 1
        &boxv;          ...          &boxv; is fetched and
        &boxv;                       &boxv; decoded
        &boxv; &boxDR;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxDL; &boxv;
        &boxv; &boxV;  Thrift metadata  &boxV; &boxv;
        &boxv; &boxUR;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxH;&boxUL; &boxv;
        &boxur;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxh;&boxul;
         Parquet File
</code></pre></div>
<p>See the <a href="https://github.com/apache/datafusion/blob/main/datafusion-examples/examples/parquet_index.rs">parquet_index.rs</a> and <a href="https://github.com/apache/datafusion/blob/main/datafusion-examples/examples/advanced_parquet_index.rs">advanced_parquet_index.rs</a> examples for more details. </p>
<p>Thanks to <a href="https://github.com/alamb">@alamb</a> and <a href="https://github.com/Ted-Jiang">@Ted-Jiang</a> for this feature.  </p>
<h2>Building Systems is Easier with DataFusion 🛠️</h2>
<p>In addition to many incremental API improvements, there are several new APIs that make
it easier to build systems on top of DataFusion:</p>
<ul>
<li>Faster and easier to use <a href="https://docs.rs/datafusion/latest/datafusion/common/tree_node/trait.TreeNode.html#overview">TreeNode API</a> for traversing and manipulating plans and expressions.</li>
<li>All functions now use the same <a href="https://docs.rs/datafusion/latest/datafusion/logical_expr/trait.ScalarUDFImpl.html">Scalar User Defined Function API</a>, making it easier to customize
  DataFusion's behavior without sacrificing performance. See <a href="https://github.com/apache/arrow-datafusion/issues/8045">ticket</a> for more details.</li>
<li>DataFusion can now be compiled to <a href="https://github.com/apache/datafusion/discussions/9834">WASM</a>. </li>
</ul>
<h1>User Defined SQL Parsing Extensions</h1>
<p>As of DataFusion 40.0.0, you can use the [<code>ExprPlanner</code>] trait to extend
DataFusion's SQL planner to support custom operators or syntax.</p>
<p>For example the <a href="https://github.com/datafusion-contrib/datafusion-functions-json">datafusion-functions-json</a> project uses this API to support
JSON operators in SQL queries. It provides a custom implementation for
planning JSON operators such as <code>-&gt;</code> and <code>-&gt;&gt;</code> with code like:</p>
<div class="codehilite"><pre><span></span><code><span class="k">struct</span> <span class="nc">MyCustomPlanner</span><span class="p">;</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">ExprPlanner</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyCustomPlanner</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Provide custom implementation for planning a binary operators</span>
<span class="w">    </span><span class="c1">// such as `-&gt;` and `-&gt;&gt;`</span>
<span class="w">    </span><span class="k">fn</span> <span class="nf">plan_binary_op</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">expr</span>: <span class="nc">RawBinaryExpr</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">_schema</span>: <span class="kp">&amp;</span><span class="nc">DFSchema</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="n">PlannerResult</span><span class="o">&lt;</span><span class="n">RawBinaryExpr</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="o">&amp;</span><span class="n">expr</span><span class="p">.</span><span class="n">op</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">           </span><span class="n">BinaryOperator</span>::<span class="n">Arrow</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* plan -&gt; operator */</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">           </span><span class="n">BinaryOperator</span>::<span class="n">LongArrow</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* plan -&gt;&gt; operator */</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">           </span><span class="o">..</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Thanks to <a href="https://github.com/samuelcolvin">@samuelcolvin</a>, <a href="https://github.com/jayzhan211">@jayzhan211</a> and <a href="https://github.com/dharanad">@dharanad</a> for helping make this
feature happen.</p>
<h1>Pluggable Support for <code>CREATE FUNCTION</code></h1>
<p>DataFusion's new [<code>FunctionFactory</code>] API let's users provide a handler for
<code>CREATE FUNCTION</code> SQL statements. This feature lets you build systems that
support defining functions in SQL such as</p>
<div class="codehilite"><pre><span></span><code><span class="c1">-- SQL based functions</span>
<span class="k">CREATE</span> <span class="k">FUNCTION</span> <span class="n">my_func</span><span class="p">(</span><span class="n">DOUBLE</span><span class="p">,</span> <span class="n">DOUBLE</span><span class="p">)</span> <span class="k">RETURNS</span> <span class="n">DOUBLE</span>
    <span class="k">RETURN</span> <span class="err">$</span><span class="mi">1</span> <span class="o">+</span> <span class="err">$</span><span class="mi">3</span>
<span class="p">;</span>

<span class="c1">-- ML Models</span>
<span class="k">CREATE</span> <span class="k">FUNCTION</span> <span class="n">iris</span><span class="p">(</span><span class="nb">FLOAT</span><span class="p">[])</span> <span class="k">RETURNS</span> <span class="nb">FLOAT</span><span class="p">[]</span> 
<span class="k">LANGUAGE</span> <span class="n">TORCH</span> <span class="k">AS</span> <span class="s1">'models:/iris@champion'</span><span class="p">;</span>

<span class="c1">-- WebAssembly</span>
<span class="k">CREATE</span> <span class="k">FUNCTION</span> <span class="n">func</span><span class="p">(</span><span class="nb">FLOAT</span><span class="p">[])</span> <span class="k">RETURNS</span> <span class="nb">FLOAT</span><span class="p">[]</span> 
<span class="k">LANGUAGE</span> <span class="n">WASM</span> <span class="k">AS</span> <span class="s1">'func.wasm'</span>
</code></pre></div>
<p>Huge thanks to <a href="https://github.com/milenkovicm">@milenkovicm</a> for this feature. There is an example of how to
make macro like functions in <a href="https://github.com/apache/datafusion/blob/main/datafusion-examples/examples/function_factory.rs">function_factory.rs</a>. It would be
great if <a href="https://github.com/apache/datafusion/issues/9326">someone made a demo</a> showing how to create WASMs 🎣.</p>
<h2>Looking Ahead: The Next Six Months 🔭</h2>
<p>The community has been <a href="https://github.com/apache/datafusion/issues/11442">discussing what we will work on in the next six months</a>.
Some major initiatives from that discussion are:</p>
<ol>
<li>
<p><em>Performance</em>: Improve the speed of <a href="https://github.com/apache/arrow-datafusion/issues/7000">aggregating "high cardinality"</a>
  data when there are many (e.g. millions) of distinct groups as well as additional
  ideas to improve parquet performance. </p>
</li>
<li>
<p><em>Modularity</em>: Make DataFusion even more modular, by completely unifying
   built in and user <a href="https://github.com/apache/datafusion/issues/8708">aggregate functions</a> and <a href="https://github.com/apache/datafusion/issues/8709">window functions</a>.</p>
</li>
<li>
<p><em>LogicalTypes</em>: <a href="https://github.com/apache/datafusion/issues/11513">Introduce Logical Types</a> to make it easier to use
   different encodings like <code>StringView</code>, <code>RunEnd</code> and <code>Dictionary</code> arrays as well
   as user defined types. Thanks <a href="https://github.com/notfilippo">@notfilippo</a> for driving this. </p>
</li>
<li>
<p><em>Improved Documentation</em>: Write blog posts and videos explaining
   how to use DataFusion for real-world use cases.</p>
</li>
<li>
<p><em>Testing</em>: Improve CI infrastructure and test coverage, more fuzz
   testing, and better functional and performance regression testing.</p>
</li>
</ol>
<h1>How to Get Involved</h1>
<p>DataFusion is not a project built or driven by a single person, company, or
foundation. Rather, our community of users and contributors work together to
build a shared technology that none of us could have built alone.</p>
<p>If you are interested in joining us we would love to have you. You can try out
DataFusion on some of your own data and projects and let us know how it goes,
contribute suggestions, documentation, bug reports, or a PR with documentation,
tests or code. A list of open issues suitable for beginners is <a href="https://github.com/apache/arrow-datafusion/issues?q=is%3Aissue+is%3Aopen+label%3A%22good+first+issue%22">here</a> and you
can find how to reach us on the <a href="https://datafusion.apache.org/contributor-guide/communication.html">communication doc</a>.</p>
        </div>
      </div>
    </div>    
    <!-- footer -->
    <div class="row">
      <div class="large-12 medium-12 columns">
        <p style="font-style: italic; font-size: 0.8rem; text-align: center;">
          Copyright 2024, <a href="https://www.apache.org/">The Apache Software Foundation</a>, Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.<br/>
          Apache&reg; and the Apache feather logo are trademarks of The Apache Software Foundation.
        </p>
      </div>
    </div>
    <script src="/js/bootstrap.bundle.min.js"></script>  </main>
  </body>
</html>
