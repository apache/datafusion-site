<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Apache DataFusion 40.0.0 Released | Apache DataFusion Project News &amp; Blog</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Apache DataFusion 40.0.0 Released" />
<meta name="author" content="pmc" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="&lt;!â€“" />
<meta property="og:description" content="&lt;!â€“" />
<link rel="canonical" href="https://datafusion.apache.org/blog/2024/07/24/datafusion-40.0.0/" />
<meta property="og:url" content="https://datafusion.apache.org/blog/2024/07/24/datafusion-40.0.0/" />
<meta property="og:site_name" content="Apache DataFusion Project News &amp; Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-07-24T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Apache DataFusion 40.0.0 Released" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"pmc"},"dateModified":"2024-07-24T00:00:00+00:00","datePublished":"2024-07-24T00:00:00+00:00","description":"&lt;!â€“","headline":"Apache DataFusion 40.0.0 Released","mainEntityOfPage":{"@type":"WebPage","@id":"https://datafusion.apache.org/blog/2024/07/24/datafusion-40.0.0/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://datafusion.apache.org/blog/img/2x_bgwhite_original.png"},"name":"pmc"},"url":"https://datafusion.apache.org/blog/2024/07/24/datafusion-40.0.0/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://datafusion.apache.org/blog/feed.xml" title="Apache DataFusion Project News &amp; Blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">Apache DataFusion Project News &amp; Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Apache DataFusion 40.0.0 Released</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2024-07-24T00:00:00+00:00" itemprop="datePublished">Jul 24, 2024
      </time>â€¢ <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">pmc</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!--

-->

<!-- see https://github.com/apache/datafusion/issues/9602 for details -->

<h2 id="introduction">Introduction</h2>

<p>We are proud to announce <a href="https://crates.io/crates/datafusion/40.0.0">DataFusion 40.0.0</a>. This blog highlights some of the
many major improvements since we released <a href="https://datafusion.apache.org/blog/2024/01/19/datafusion-34.0.0/">DataFusion 34.0.0</a> and a preview of
what the community is thinking about in the next 6 months. We are hoping to make
more regular blog posts â€“ if you are interested in helping write them, please
reach out!</p>

<p><a href="https://datafusion.apache.org/">Apache DataFusion</a> is an extensible query engine, written in <a href="https://www.rust-lang.org/">Rust</a>, that
uses <a href="https://arrow.apache.org">Apache Arrow</a> as its in-memory format. DataFusion is used by developers to
create new, fast data centric systems such as databases, dataframe libraries,
machine learning and streaming applications. While <a href="https://datafusion.apache.org/user-guide/introduction.html#project-goals">DataFusionâ€™s primary design
goal</a> is to accelerate the creation of other data centric systems, it has a
reasonable experience directly out of the box as a <a href="https://datafusion.apache.org/python/">dataframe library</a> and
<a href="https://datafusion.apache.org/user-guide/cli/">command line SQL tool</a>.</p>

<p>DataFusionâ€™s core thesis is that as a community, together we can build much more
advanced technology than any of us as individuals or companies could do alone. 
Without DataFusion, highly performant vectorized query engines would remain
the domain of a few large companies and world-class research institutions. 
With DataFusion, we can all build on top of a shared foundation, and focus on
what makes our projects unique.</p>

<h2 id="community-growth--">Community Growth  ğŸ“ˆ</h2>

<p>In the last 6 months, between <code class="language-plaintext highlighter-rouge">34.0.0</code> and <code class="language-plaintext highlighter-rouge">40.0.0</code>, our community continues to
grow in new and exciting ways.</p>

<ol>
  <li>DataFusion became a top level Apache Software Foundation project (read the
<a href="https://news.apache.org/foundation/entry/apache-software-foundation-announces-new-top-level-project-apache-datafusion">press release</a> and <a href="https://datafusion.apache.org/blog/2024/05/07/datafusion-tlp/">blog post</a>).</li>
  <li>We added several PMC members and new
committers: <a href="https://github.com/comphead">@comphead</a>, <a href="https://github.com/mustafasrepo">@mustafasrepo</a>, <a href="https://github.com/ozankabak">@ozankabak</a>, and <a href="https://github.com/waynexia">@waynexia</a> joined the PMC,
<a href="https://github.com/jonahgao">@jonahgao</a> and <a href="https://github.com/lewiszlw">@lewiszlw</a> joined as committers. See the <a href="https://lists.apache.org/list.html?dev@datafusion.apache.org">mailing list</a> for
more details.</li>
  <li><a href="https://datafusion.apache.org/comet/">DataFusion Comet</a> was <a href="https://arrow.apache.org/blog/2024/03/06/comet-donation/">donated</a> and is nearing its first release.</li>
  <li>In the <a href="https://github.com/apache/arrow-datafusion">core DataFusion repo</a> alone we reviewed and accepted almost 1500 PRs from 182 different
committers, created over 1000 issues and closed 781 of them ğŸš€. This is up
almost 50% from our last post (1000 PRs from 124 committers with 650 issues
created in our last post) ğŸ¤¯. All changes are listed in the detailed
<a href="https://github.com/apache/datafusion/blob/main/datafusion/CHANGELOG.md">CHANGELOG</a>.</li>
  <li>DataFusion focused meetups happened or are happening in multiple cities 
around the world: <a href="https://github.com/apache/datafusion/discussions/8522">Austin</a>, <a href="https://github.com/apache/datafusion/discussions/10800">San Francisco</a>, <a href="https://www.huodongxing.com/event/5761971909400?td=1965290734055">Hangzhou</a>, <a href="https://github.com/apache/datafusion/discussions/11213">New York</a>, and
<a href="https://github.com/apache/datafusion/discussions/11431">Belgrade</a>.</li>
  <li>Many new projects started in the <a href="https://github.com/datafusion-contrib">datafusion-contrib</a> organization, including
<a href="https://github.com/datafusion-contrib/datafusion-table-providers">Table Providers</a>, <a href="https://github.com/datafusion-contrib/datafusion-sqlancer">SQLancer</a>, <a href="https://github.com/datafusion-contrib/datafusion-functions-variant">Open Variant</a>, <a href="https://github.com/datafusion-contrib/datafusion-functions-json">JSON</a>, and <a href="https://github.com/datafusion-contrib/datafusion-orc">ORC</a>.</li>
</ol>

<!--
$ git log --pretty=oneline 34.0.0..40.0.0 . | wc -l
     1453 (up from 1009)

$ git shortlog -sn 34.0.0..40.0.0 . | wc -l
      182 (up from 124)

https://crates.io/crates/datafusion/34.0.0
DataFusion 34 released Dec 17, 2023

https://crates.io/crates/datafusion/40.0.0
DataFusion 34 released July 12, 2024

Issues created in this time: 321 open, 781 closed (up from 214 open, 437 closed)
https://github.com/apache/arrow-datafusion/issues?q=is%3Aissue+created%3A2023-12-17..2024-07-12

Issues closed: 911 (up from 517)
https://github.com/apache/arrow-datafusion/issues?q=is%3Aissue+closed%3A2023-12-17..2024-07-12

PRs merged in this time 1490 (up from 908)
https://github.com/apache/arrow-datafusion/pulls?q=is%3Apr+merged%3A2023-12-17..2024-07-12

-->

<p>In addition, DataFusion has been appearing publicly more and more, both online and offline. Here are some highlights:</p>

<ol>
  <li><a href="https://dl.acm.org/doi/10.1145/3626246.3653368">Apache Arrow DataFusion: A Fast, Embeddable, Modular Analytic Query Engine</a>, was presented in <a href="https://2024.sigmod.org/">SIGMOD â€˜24</a>, one of the major database conferences</li>
  <li>As part of the trend to define â€œthe POSIX of databasesâ€ in <a href="https://db.cs.cmu.edu/papers/2024/whatgoesaround-sigmodrec2024.pdf">â€œWhat Goes Around Comes Aroundâ€¦ And Aroundâ€¦â€</a> from Andy Pavlo and Mike Stonebraker</li>
  <li><a href="https://www.cpard.xyz/posts/datafusion/">â€œWhy you should keep an eye on Apache DataFusion and its communityâ€</a></li>
  <li><a href="https://www.tisonkun.org/2024/07/15/datafusion-meetup-san-francisco/">Apache DataFusion offline meetup in the Bay Area</a></li>
</ol>

<h2 id="improved-performance-">Improved Performance ğŸš€</h2>

<p>Performance is a key feature of DataFusion, and the community continues to work
to keep DataFusion state of the art in this area. One major area DataFusion
improved is the time it takes to convert a SQL query into a plan that can be
executed. Planning is now almost 2x faster for TPC-DS and TPC-H queries, and
over 10x faster for some queries with many columns.</p>

<p>Here is a chart showing the improvement due to the concerted effort of many
contributors including <a href="https://github.com/jackwener">@jackwener</a>, <a href="https://github.com/alamb">@alamb</a>, <a href="https://github.com/Lordworms">@Lordworms</a>, <a href="https://github.com/dmitrybugakov">@dmitrybugakov</a>,
<a href="https://github.com/appletreeisyellow">@appletreeisyellow</a>, <a href="https://github.com/ClSlaid">@ClSlaid</a>, <a href="https://github.com/rohitrastogi">@rohitrastogi</a>, <a href="https://github.com/emgeee">@emgeee</a>, <a href="https://github.com/kevinmingtarja">@kevinmingtarja</a>,
and <a href="https://github.com/peter-toth">@peter-toth</a> over several months (see <a href="https://github.com/apache/arrow-datafusion/issues/8045">ticket</a> for more details)</p>

<p><img src="/blog/assets/datafusion-40.0.0/improved-planning-time.png" width="700" /></p>

<p>DataFusion is now up to 40% faster for queries that <code class="language-plaintext highlighter-rouge">GROUP BY</code> a single string
or binary column due to a <a href="https://github.com/apache/datafusion/pull/8827">specialization for single
Uft8/LargeUtf8/Binary/LargeBinary</a>. We are working on improving performance when
there are <a href="https://github.com/apache/datafusion/issues/9403">multiple variable length columns in the <code class="language-plaintext highlighter-rouge">GROUP BY</code> clause</a>.</p>

<p>We are also in the final phases of <a href="https://github.com/apache/datafusion/issues/10918">integrating</a> the new <a href="https://docs.rs/arrow/latest/arrow/array/struct.GenericByteViewArray.html">Arrow StringView</a>
which significantly improves performance for workloads that scan, filter and
group by variable length string and binary data. We expect the improvement to be
especially pronounced for Parquet files due to <a href="https://github.com/apache/arrow-rs/issues/5530">upstream work in the parquet
reader</a>. Kudos to <a href="https://github.com/XiangpengHong">@XiangpengHong</a>, <a href="https://github.com/AriesDevil">@AriesDevil</a>, <a href="https://github.com/PsiACE">@PsiACE</a>, <a href="https://github.com/Weijun-H">@Weijun-H</a>,
<a href="https://github.com/a10y">@a10y</a>, and <a href="https://github.com/RinChanNOWWW">@RinChanNOWWW</a> for driving this project.</p>

<h2 id="improved-quality-">Improved Quality ğŸ“‹</h2>

<p>DataFusion continues to improve overall in quality. In addition to ongoing bug
fixes, one of the most exciting improvements is the addition of a new <a href="https://github.com/datafusion-contrib/datafusion-sqlancer">SQLancer</a>
based <a href="https://github.com/apache/datafusion/issues/11030">DataFusion Fuzzing</a> suite thanks to <a href="https://github.com/2010YOUY01">@2010YOUY01</a> that has already found
several bugs and thanks to <a href="https://github.com/jonahgao">@jonahgao</a>, <a href="https://github.com/tshauck">@tshauck</a>, <a href="https://github.com/xinlifoobar">@xinlifoobar</a>,
<a href="https://github.com/LorrensP-2158466">@LorrensP-2158466</a> for fixing them so fast.</p>

<h2 id="improved-documentation-">Improved Documentation ğŸ“š</h2>

<p>We continue to improve the documentation to make it easier to get started using DataFusion with
the <a href="https://datafusion.apache.org/library-user-guide/index.html">Library Users Guide</a>, <a href="https://docs.rs/datafusion/latest/datafusion/index.html">API documentation</a>, and <a href="https://github.com/apache/datafusion/tree/main/datafusion-examples">Examples</a>.</p>

<p>Some notable new examples include:</p>
<ul>
  <li><a href="https://github.com/apache/datafusion/blob/main/datafusion-examples/examples/sql_analysis.rs">sql_analysis.rs</a> to analyse SQL queries with DataFusion structures (thanks <a href="https://github.com/LorrensP-2158466">@LorrensP-2158466</a>)</li>
  <li><a href="https://github.com/apache/datafusion/blob/main/datafusion-examples/examples/function_factory.rs">function_factory.rs</a> to create custom functions via SQL (thanks <a href="https://github.com/milenkovicm">@milenkovicm</a>)</li>
  <li><a href="https://github.com/apache/datafusion/blob/main/datafusion-examples/examples/plan_to_sql.rs">plan_to_sql.rs</a> to generate SQL from DataFusion Expr and LogicalPlan (thanks <a href="https://github.com/edmondop">@edmondop</a>)</li>
  <li><a href="https://github.com/apache/datafusion/blob/main/datafusion-examples/examples/parquet_index.rs">parquet_index.rs</a> and <a href="https://github.com/apache/datafusion/blob/main/datafusion-examples/examples/advanced_parquet_index.rs">advanced_parquet_index.rs</a> for parquet indexing, described more below (thanks <a href="https://github.com/alamb">@alamb</a>)</li>
</ul>

<h2 id="new-features-">New Features âœ¨</h2>

<p>There are too many new features in the last 6 months to list them all, but here
are some highlights:</p>

<h1 id="sql">SQL</h1>
<ul>
  <li>Support for <code class="language-plaintext highlighter-rouge">UNNEST</code> (thanks <a href="https://github.com/duongcongtoai">@duongcongtoai</a>, <a href="https://github.com/JasonLi-cn">@JasonLi-cn</a> and <a href="https://github.com/jayzhan211">@jayzhan211</a>)</li>
  <li>Support for <a href="https://github.com/apache/datafusion/issues/462">Recursive CTEs</a> (thanks <a href="https://github.com/jonahgao">@jonahgao</a> and <a href="https://github.com/matthewgapp">@matthewgapp</a>)</li>
  <li>Support for <code class="language-plaintext highlighter-rouge">CREATE FUNCTION</code> (see below)</li>
  <li>Many new SQL functions</li>
</ul>

<p>DataFusion now has much improved support for structured types such <code class="language-plaintext highlighter-rouge">STRUCT</code>,
<code class="language-plaintext highlighter-rouge">LIST</code>/<code class="language-plaintext highlighter-rouge">ARRAY</code> and <code class="language-plaintext highlighter-rouge">MAP</code>. For example, you can now create <code class="language-plaintext highlighter-rouge">STRUCT</code> literals 
in SQL like this:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="n">select</span> <span class="p">{</span><span class="nv">'foo</span><span class="err">'</span><span class="p">:</span> <span class="p">{</span><span class="nv">'bar</span><span class="err">'</span><span class="p">:</span> <span class="mi">2</span><span class="p">}};</span>
<span class="o">+--------------------------------------------------------------+</span>
<span class="p">|</span> <span class="nf">named_struct</span><span class="p">(</span><span class="nf">Utf8</span><span class="p">(</span><span class="s">"foo"</span><span class="p">),</span><span class="nf">named_struct</span><span class="p">(</span><span class="nf">Utf8</span><span class="p">(</span><span class="s">"bar"</span><span class="p">),</span><span class="nf">Int64</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span> <span class="p">|</span>
<span class="o">+--------------------------------------------------------------+</span>
<span class="p">|</span> <span class="p">{</span><span class="n">foo</span><span class="p">:</span> <span class="p">{</span><span class="n">bar</span><span class="p">:</span> <span class="mi">2</span><span class="p">}}</span>                                              <span class="p">|</span>
<span class="o">+--------------------------------------------------------------+</span>
<span class="mi">1</span> <span class="nf">row</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">fetched</span><span class="py">.
Elapsed</span> <span class="mf">0.002</span> <span class="n">seconds</span><span class="err">.</span>
</code></pre></div></div>

<h1 id="sql-unparser-sql-formatter">SQL Unparser (SQL Formatter)</h1>

<p>DataFusion now supports converting <code class="language-plaintext highlighter-rouge">Expr</code>s and <code class="language-plaintext highlighter-rouge">LogicalPlan</code>s BACK to SQL text.
This can be useful in query federation to push predicates down into other
systems that only accept SQL, and for building systems that generate SQL.</p>

<p>For example, you can now convert a logical expression back to SQL text:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Form a logical expression that represents the SQL "a &lt; 5 OR a = 8"</span>
<span class="k">let</span> <span class="n">expr</span> <span class="o">=</span> <span class="nf">col</span><span class="p">(</span><span class="s">"a"</span><span class="p">)</span><span class="nf">.lt</span><span class="p">(</span><span class="nf">lit</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="nf">.or</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="s">"a"</span><span class="p">)</span><span class="nf">.eq</span><span class="p">(</span><span class="nf">lit</span><span class="p">(</span><span class="mi">8</span><span class="p">)));</span>
<span class="c1">// convert the expression back to SQL text</span>
<span class="k">let</span> <span class="n">sql</span> <span class="o">=</span> <span class="nf">expr_to_sql</span><span class="p">(</span><span class="o">&amp;</span><span class="n">expr</span><span class="p">)</span><span class="o">?</span><span class="nf">.to_string</span><span class="p">();</span>
<span class="nd">assert_eq!</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="s">"a &lt; 5 OR a = 8"</span><span class="p">);</span>
</code></pre></div></div>

<p>You can also do complex things like parsing SQL, modifying the plan, and convert
it back to SQL:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="n">df</span> <span class="o">=</span> <span class="n">ctx</span>
  <span class="c1">// Use SQL to read some data from the parquet file</span>
  <span class="nf">.sql</span><span class="p">(</span><span class="s">"SELECT int_col, double_col, CAST(date_string_col as VARCHAR) FROM alltypes_plain"</span><span class="p">)</span>
  <span class="k">.await</span><span class="o">?</span><span class="p">;</span>
<span class="c1">// Programmatically add new filters `id &gt; 1 and tinyint_col &lt; double_col`</span>
<span class="k">let</span> <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="nf">.filter</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="s">"id"</span><span class="p">)</span><span class="nf">.gt</span><span class="p">(</span><span class="nf">lit</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="nf">.and</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="s">"tinyint_col"</span><span class="p">)</span><span class="nf">.lt</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="s">"double_col"</span><span class="p">))))</span><span class="o">?</span>
<span class="c1">// Convert the new logical plan back to SQL</span>
<span class="k">let</span> <span class="n">sql</span> <span class="o">=</span> <span class="nf">plan_to_sql</span><span class="p">(</span><span class="n">df</span><span class="nf">.logical_plan</span><span class="p">())</span><span class="o">?</span><span class="nf">.to_string</span><span class="p">();</span>
<span class="nd">assert_eq!</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> 
           <span class="s">"SELECT alltypes_plain.int_col, alltypes_plain.double_col, CAST(alltypes_plain.date_string_col AS VARCHAR) </span><span class="err">\</span><span class="s">
           FROM alltypes_plain WHERE ((alltypes_plain.id &gt; 1) AND (alltypes_plain.tinyint_col &lt; alltypes_plain.double_col))"</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<p>See the <a href="https://github.com/apache/datafusion/blob/main/datafusion-examples/examples/plan_to_sql.rs">Plan to SQL example</a> or the APIs <a href="https://docs.rs/datafusion/latest/datafusion/sql/unparser/fn.expr_to_sql.html">expr_to_sql</a> and <a href="https://docs.rs/datafusion/latest/datafusion/sql/unparser/fn.plan_to_sql.html">plan_to_sql</a> for more details.</p>

<h1 id="low-level-apis-for-fast-parquet-access-indexing">Low Level APIs for Fast Parquet Access (indexing)</h1>

<p>With their rising prevalence, supporting efficient access to Parquet files
stored remotely on object storage is important. Part of doing this efficiently
is minimizing the number of object store requests made by caching metadata and
skipping over parts of the file that are not needed (e.g. via an index).</p>

<p>DataFusionâ€™s Parquet reader has long internally supported <a href="https://arrow.apache.org/blog/2022/12/26/querying-parquet-with-millisecond-latency/">advanced predicate
pushdown</a> by reading the parquet metadata from the file footer and pruning based
on row group and data page statistics. DataFusion now also supports users
supplying their own low level pruning information via the <a href="https://docs.rs/datafusion/latest/datafusion/datasource/physical_plan/parquet/struct.ParquetAccessPlan.html"><code class="language-plaintext highlighter-rouge">ParquetAccessPlan</code></a>
API.</p>

<p>This API can be used along with index information to selectively skip decoding
parts of the file. For example, Spice AI used this feature to add <a href="https://github.com/spiceai/spiceai/pull/1891">efficient
support</a> for reading from DeltaLake tables and handling <a href="https://docs.delta.io/latest/delta-deletion-vectors.html">deletion vectors</a>.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   If the RowSelection does not include any
        â”‚          ...          â”‚   rows from a particular Data Page, that
        â”‚                       â”‚   Data Page is not fetched or decoded.
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   Note this requires a PageIndex
        â”‚ â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
Row     â”‚ â”‚     â”‚DataPage 0â”‚  â”‚ â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
Groups  â”‚ â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚                 â”‚                    â”‚
        â”‚ â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚                 â”‚    ParquetExec     â”‚
        â”‚ â”‚ ... â”‚DataPage 1â”‚ â—€â”¼ â”¼ â”€ â”€ â”€           â”‚  (Parquet Reader)  â”‚
        â”‚ â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚      â”” â”€ â”€ â”€ â”€ â”€â”‚                    â”‚
        â”‚ â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚                 â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚
        â”‚ â”‚     â”‚DataPage 2â”‚  â”‚ â”‚ If only rows    â”‚ â•‘ParquetMetadataâ•‘  â”‚
        â”‚ â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚ from DataPage 1 â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ are selected,   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                       â”‚ only DataPage 1
        â”‚          ...          â”‚ is fetched and
        â”‚                       â”‚ decoded
        â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚
        â”‚ â•‘  Thrift metadata  â•‘ â”‚
        â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         Parquet File
</code></pre></div></div>

<p>See the <a href="https://github.com/apache/datafusion/blob/main/datafusion-examples/examples/parquet_index.rs">parquet_index.rs</a> and <a href="https://github.com/apache/datafusion/blob/main/datafusion-examples/examples/advanced_parquet_index.rs">advanced_parquet_index.rs</a> examples for more details.</p>

<p>Thanks to <a href="https://github.com/alamb">@alamb</a> and <a href="https://github.com/Ted-Jiang">@Ted-Jiang</a> for this feature.</p>

<h2 id="building-systems-is-easier-with-datafusion-ï¸">Building Systems is Easier with DataFusion ğŸ› ï¸</h2>

<p>In addition to many incremental API improvements, there are several new APIs that make
it easier to build systems on top of DataFusion:</p>

<ul>
  <li>Faster and easier to use <a href="https://docs.rs/datafusion/latest/datafusion/common/tree_node/trait.TreeNode.html#overview">TreeNode API</a> for traversing and manipulating plans and expressions.</li>
  <li>All functions now use the same <a href="https://docs.rs/datafusion/latest/datafusion/logical_expr/trait.ScalarUDFImpl.html">Scalar User Defined Function API</a>, making it easier to customize
DataFusionâ€™s behavior without sacrificing performance. See <a href="https://github.com/apache/arrow-datafusion/issues/8045">ticket</a> for more details.</li>
  <li>DataFusion can now be compiled to <a href="https://github.com/apache/datafusion/discussions/9834">WASM</a>.</li>
</ul>

<h1 id="user-defined-sql-parsing-extensions">User Defined SQL Parsing Extensions</h1>

<p>As of DataFusion 40.0.0, you can use the <a href="https://docs.rs/datafusion/latest/datafusion/logical_expr/planner/trait.ExprPlanner.html"><code class="language-plaintext highlighter-rouge">ExprPlanner</code></a> trait to extend
DataFusionâ€™s SQL planner to support custom operators or syntax.</p>

<p>For example the <a href="https://github.com/datafusion-contrib/datafusion-functions-json">datafusion-functions-json</a> project uses this API to support
JSON operators in SQL queries. It provides a custom implementation for
planning JSON operators such as <code class="language-plaintext highlighter-rouge">-&gt;</code> and <code class="language-plaintext highlighter-rouge">-&gt;&gt;</code> with code like:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">MyCustomPlanner</span><span class="p">;</span>

<span class="k">impl</span> <span class="n">ExprPlanner</span> <span class="k">for</span> <span class="n">MyCustomPlanner</span> <span class="p">{</span>
    <span class="c1">// Provide custom implementation for planning a binary operators</span>
    <span class="c1">// such as `-&gt;` and `-&gt;&gt;`</span>
    <span class="k">fn</span> <span class="nf">plan_binary_op</span><span class="p">(</span>
        <span class="o">&amp;</span><span class="k">self</span><span class="p">,</span>
        <span class="n">expr</span><span class="p">:</span> <span class="n">RawBinaryExpr</span><span class="p">,</span>
        <span class="n">_schema</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">DFSchema</span><span class="p">,</span>
    <span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="n">PlannerResult</span><span class="o">&lt;</span><span class="n">RawBinaryExpr</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
        <span class="k">match</span> <span class="o">&amp;</span><span class="n">expr</span><span class="py">.op</span> <span class="p">{</span>
           <span class="nn">BinaryOperator</span><span class="p">::</span><span class="n">Arrow</span> <span class="k">=&gt;</span> <span class="p">{</span> <span class="cm">/* plan -&gt; operator */</span> <span class="p">}</span>
           <span class="nn">BinaryOperator</span><span class="p">::</span><span class="n">LongArrow</span> <span class="k">=&gt;</span> <span class="p">{</span> <span class="cm">/* plan -&gt;&gt; operator */</span> <span class="p">}</span>
           <span class="o">...</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Thanks to <a href="https://github.com/samuelcolvin">@samuelcolvin</a>, <a href="https://github.com/jayzhan211">@jayzhan211</a> and <a href="https://github.com/dharanad">@dharanad</a> for helping make this
feature happen.</p>

<h1 id="pluggable-support-for-create-function">Pluggable Support for <code class="language-plaintext highlighter-rouge">CREATE FUNCTION</code></h1>

<p>DataFusionâ€™s new <a href="https://docs.rs/datafusion/latest/datafusion/execution/context/trait.FunctionFactory.html"><code class="language-plaintext highlighter-rouge">FunctionFactory</code></a> API letâ€™s users provide a handler for
<code class="language-plaintext highlighter-rouge">CREATE FUNCTION</code> SQL statements. This feature lets you build systems that
support defining functions in SQL such as</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- SQL based functions</span>
<span class="k">CREATE</span> <span class="k">FUNCTION</span> <span class="n">my_func</span><span class="p">(</span><span class="nb">DOUBLE</span><span class="p">,</span> <span class="nb">DOUBLE</span><span class="p">)</span> <span class="k">RETURNS</span> <span class="nb">DOUBLE</span>
    <span class="k">RETURN</span> <span class="err">$</span><span class="mi">1</span> <span class="o">+</span> <span class="err">$</span><span class="mi">3</span>
<span class="p">;</span>

<span class="c1">-- ML Models</span>
<span class="k">CREATE</span> <span class="k">FUNCTION</span> <span class="n">iris</span><span class="p">(</span><span class="nb">FLOAT</span><span class="p">[])</span> <span class="k">RETURNS</span> <span class="nb">FLOAT</span><span class="p">[]</span> 
<span class="k">LANGUAGE</span> <span class="n">TORCH</span> <span class="k">AS</span> <span class="s1">'models:/iris@champion'</span><span class="p">;</span>

<span class="c1">-- WebAssembly</span>
<span class="k">CREATE</span> <span class="k">FUNCTION</span> <span class="n">func</span><span class="p">(</span><span class="nb">FLOAT</span><span class="p">[])</span> <span class="k">RETURNS</span> <span class="nb">FLOAT</span><span class="p">[]</span> 
<span class="k">LANGUAGE</span> <span class="n">WASM</span> <span class="k">AS</span> <span class="s1">'func.wasm'</span>
</code></pre></div></div>

<p>Huge thanks to <a href="https://github.com/milenkovicm">@milenkovicm</a> for this feature. There is an example of how to
make macro like functions in <a href="https://github.com/apache/datafusion/blob/main/datafusion-examples/examples/function_factory.rs">function_factory.rs</a>. It would be
great if <a href="https://github.com/apache/datafusion/issues/9326">someone made a demo</a> showing how to create WASMs ğŸ£.</p>

<h2 id="looking-ahead-the-next-six-months-">Looking Ahead: The Next Six Months ğŸ”­</h2>

<p>The community has been <a href="https://github.com/apache/datafusion/issues/11442">discussing what we will work on in the next six months</a>.
Some major initiatives from that discussion are:</p>

<ol>
  <li>
    <p><em>Performance</em>: Improve the speed of <a href="https://github.com/apache/arrow-datafusion/issues/7000">aggregating â€œhigh cardinalityâ€</a>
  data when there are many (e.g. millions) of distinct groups as well as additional
  ideas to improve parquet performance.</p>
  </li>
  <li>
    <p><em>Modularity</em>: Make DataFusion even more modular, by completely unifying
built in and user <a href="https://github.com/apache/datafusion/issues/8708">aggregate functions</a> and <a href="https://github.com/apache/datafusion/issues/8709">window functions</a>.</p>
  </li>
  <li>
    <p><em>LogicalTypes</em>: <a href="https://github.com/apache/datafusion/issues/11513">Introduce Logical Types</a> to make it easier to use
different encodings like <code class="language-plaintext highlighter-rouge">StringView</code>, <code class="language-plaintext highlighter-rouge">RunEnd</code> and <code class="language-plaintext highlighter-rouge">Dictionary</code> arrays as well
as user defined types. Thanks <a href="https://github.com/notfilippo">@notfilippo</a> for driving this.</p>
  </li>
  <li>
    <p><em>Improved Documentation</em>: Write blog posts and videos explaining
how to use DataFusion for real-world use cases.</p>
  </li>
  <li>
    <p><em>Testing</em>: Improve CI infrastructure and test coverage, more fuzz
testing, and better functional and performance regression testing.</p>
  </li>
</ol>

<h1 id="how-to-get-involved">How to Get Involved</h1>

<p>DataFusion is not a project built or driven by a single person, company, or
foundation. Rather, our community of users and contributors work together to
build a shared technology that none of us could have built alone.</p>

<p>If you are interested in joining us we would love to have you. You can try out
DataFusion on some of your own data and projects and let us know how it goes,
contribute suggestions, documentation, bug reports, or a PR with documentation,
tests or code. A list of open issues suitable for beginners is <a href="https://github.com/apache/arrow-datafusion/issues?q=is%3Aissue+is%3Aopen+label%3A%22good+first+issue%22">here</a> and you
can find how to reach us on the <a href="https://datafusion.apache.org/contributor-guide/communication.html">communication doc</a>.</p>


  </div><a class="u-url" href="/blog/2024/07/24/datafusion-40.0.0/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Apache DataFusion Project News &amp; Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Apache DataFusion Project News &amp; Blog</li><li><a class="u-email" href="mailto:dev@datafusion.apache.org">dev@datafusion.apache.org</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://www.twitter.com/ApacheDataFusio"><svg class="svg-icon"><use xlink:href="/blog/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">ApacheDataFusio</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Apache DataFusion is a very fast, extensible query engine for building high-quality  data-centric systems in Rust, using the Apache Arrow in-memory format.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
