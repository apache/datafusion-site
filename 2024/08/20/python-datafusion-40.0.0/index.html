<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Apache DataFusion Python 40.1.0 Released, Significant usability updates | Apache DataFusion Project News &amp; Blog</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Apache DataFusion Python 40.1.0 Released, Significant usability updates" />
<meta name="author" content="timsaucer" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="&lt;!–" />
<meta property="og:description" content="&lt;!–" />
<link rel="canonical" href="https://datafusion.apache.org/blog/2024/08/20/python-datafusion-40.0.0/" />
<meta property="og:url" content="https://datafusion.apache.org/blog/2024/08/20/python-datafusion-40.0.0/" />
<meta property="og:site_name" content="Apache DataFusion Project News &amp; Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-08-20T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Apache DataFusion Python 40.1.0 Released, Significant usability updates" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"timsaucer"},"dateModified":"2024-08-20T00:00:00+00:00","datePublished":"2024-08-20T00:00:00+00:00","description":"&lt;!–","headline":"Apache DataFusion Python 40.1.0 Released, Significant usability updates","mainEntityOfPage":{"@type":"WebPage","@id":"https://datafusion.apache.org/blog/2024/08/20/python-datafusion-40.0.0/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://datafusion.apache.org/blog/img/2x_bgwhite_original.png"},"name":"timsaucer"},"url":"https://datafusion.apache.org/blog/2024/08/20/python-datafusion-40.0.0/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://datafusion.apache.org/blog/feed.xml" title="Apache DataFusion Project News &amp; Blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">Apache DataFusion Project News &amp; Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Apache DataFusion Python 40.1.0 Released, Significant usability updates</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2024-08-20T00:00:00+00:00" itemprop="datePublished">Aug 20, 2024
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">timsaucer</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!--

-->

<h2 id="introduction">Introduction</h2>

<p>We are happy to announce that <a href="https://pypi.org/project/datafusion/40.1.0/">DataFusion in Python 40.1.0</a> has been released. In addition to
bringing in all of the new features of the core <a href="https://datafusion.apache.org/blog/2024/07/24/datafusion-40.0.0/">DataFusion 40.0.0</a> package, this release
contains <em>significant</em> updates to the user interface and documentation. We listened to the python
user community to create a more <em>pythonic</em> experience. If you have not used the python interface to
DataFusion before, this is an excellent time to give it a try!</p>

<h2 id="background">Background</h2>

<p>Until now, the python bindings for DataFusion have primarily been a thin layer to expose the
underlying Rust functionality. This has been worked well for early adopters to use DataFusion
within their Python projects, but some users have found it difficult to work with. As compared to
other DataFrame libraries, these issues were raised:</p>

<ol>
  <li>Most of the functions had little or no documentation. Users often had to refer to the Rust
documentation or code to learn how to use DataFusion. This alienated some python users.</li>
  <li>Users could not take advantage of modern IDE features such as type hinting. These are valuable
tools for rapid testing and development.</li>
  <li>Some of the interfaces felt “clunky” to users since some Python concepts do not always map well
to their Rust counterparts.</li>
</ol>

<p>This release aims to bring a better user experience to the DataFusion Python community.</p>

<h2 id="whats-changed">What’s Changed</h2>

<p>The most significant difference is that we have added wrapper functions and classes for most of the
user facing interface. These wrappers, written in Python, contain both documentation and type
annotations.</p>

<p>This documenation is now available on the <a href="https://datafusion.apache.org/python/autoapi/datafusion/index.html">DataFusion in Python API</a> website. There you can browse
the available functions and classes to see the breadth of available functionality.</p>

<p>Modern IDEs use language servers such as
<a href="https://marketplace.visualstudio.com/items?itemName=ms-python.vscode-pylance">Pylance</a> or
<a href="https://jedi.readthedocs.io/en/latest/">Jedi</a> to perform analysis of python code, provide useful
hints, and identify usage errors. These are major tools in the python user community. With this
release, users can fully use these tools in their workflow.</p>

<figure style="text-align: center;">
  <img src="/blog/img/python-datafusion-40.0.0/vscode_hover_tooltip.png" width="100%" class="img-responsive" alt="Fig 1: Enhanced tooltips in an IDE." />
  <figcaption>
   <b>Figure 1</b>: With the enhanced python wrappers, users can see helpful tool tips with
   type annotations directly in modern IDEs.
</figcaption>
</figure>

<p>By having the type annotations, these IDEs can also identify quickly when a user has incorrectly
used a function’s arguments as shown in Figure 2.</p>

<figure style="text-align: center;">
  <img src="/blog/img/python-datafusion-40.0.0/pylance_error_checking.png" width="100%" class="img-responsive" alt="Fig 2: Error checking in static analysis" />
  <figcaption>
   <b>Figure 2</b>: Modern Python language servers can perform static analysis and quickly find
   errors in the arguments to functions.
</figcaption>
</figure>

<p>In addition to these wrapper libraries, we have enhancements to some of the functions to feel more
easy to use.</p>

<h3 id="improved-dataframe-filter-arguments">Improved DataFrame filter arguments</h3>

<p>You can now apply multiple <code class="language-plaintext highlighter-rouge">filter</code> statements in a single step. When using <code class="language-plaintext highlighter-rouge">DataFrame.filter</code> you
can pass in multiple arguments, separated by a comma. These will act as a logical <code class="language-plaintext highlighter-rouge">AND</code> of all of
the filter arguments. The following two statements are equivalent:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">max_size</span><span class="sh">"</span><span class="p">)).</span><span class="nf">filter</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">color</span><span class="sh">"</span><span class="p">)</span> <span class="o">==</span> <span class="nf">lit</span><span class="p">(</span><span class="sh">"</span><span class="s">green</span><span class="sh">"</span><span class="p">))</span>
<span class="n">df</span><span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">max_size</span><span class="sh">"</span><span class="p">),</span> <span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">color</span><span class="sh">"</span><span class="p">)</span> <span class="o">==</span> <span class="nf">lit</span><span class="p">(</span><span class="sh">"</span><span class="s">green</span><span class="sh">"</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="comparison-against-literal-values">Comparison against literal values</h3>

<p>It is very common to write DataFrame operations that compare an expression to some fixed value.
For example, filtering a DataFrame might have an operation such as <code class="language-plaintext highlighter-rouge">df.filter(col("size") &lt; lit(16))</code>.
To make these common operations more ergonomic, you can now simply use <code class="language-plaintext highlighter-rouge">df.filter(col("size") &lt; 16)</code>.</p>

<p>For the right hand side of the comparison operator, you can now use any Python value that can be
coerced into a <code class="language-plaintext highlighter-rouge">Literal</code>. This gives an easy to ready expression. For example, consider these few
lines from one of the
<a href="https://github.com/apache/datafusion-python/tree/main/examples/tpch">TPC-H examples</a> provided in
the DataFusion Python repository.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df_lineitem</span><span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">l_shipdate</span><span class="sh">"</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nf">lit</span><span class="p">(</span><span class="n">date</span><span class="p">))</span>
    <span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">l_discount</span><span class="sh">"</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nf">lit</span><span class="p">(</span><span class="n">DISCOUNT</span><span class="p">)</span> <span class="o">-</span> <span class="nf">lit</span><span class="p">(</span><span class="n">DELTA</span><span class="p">))</span>
    <span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">l_discount</span><span class="sh">"</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nf">lit</span><span class="p">(</span><span class="n">DISCOUNT</span><span class="p">)</span> <span class="o">+</span> <span class="nf">lit</span><span class="p">(</span><span class="n">DELTA</span><span class="p">))</span>
    <span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">l_quantity</span><span class="sh">"</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nf">lit</span><span class="p">(</span><span class="n">QUANTITY</span><span class="p">))</span>
<span class="p">)</span>
</code></pre></div></div>

<p>The above code mirrors closely how these filters would need to be applied in rust. With this new
release, the user can simplify these lines. Also shown in the example below is that <code class="language-plaintext highlighter-rouge">filter()</code>
now accepts a variable number of arguments and filters on all such arguments (boolean AND).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">df_lineitem</span><span class="p">.</span><span class="nf">filter</span><span class="p">(</span>
    <span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">l_shipdate</span><span class="sh">"</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">date</span><span class="p">,</span>
    <span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">l_discount</span><span class="sh">"</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">DISCOUNT</span> <span class="o">-</span> <span class="n">DELTA</span><span class="p">,</span>
    <span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">l_discount</span><span class="sh">"</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">DISCOUNT</span> <span class="o">+</span> <span class="n">DELTA</span><span class="p">,</span>
    <span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">l_quantity</span><span class="sh">"</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">QUANTITY</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="select-columns-by-name">Select columns by name</h3>

<p>It is very common for users to perform <code class="language-plaintext highlighter-rouge">DataFrame</code> selection where they simply want a column. For
this we have had the function <code class="language-plaintext highlighter-rouge">select_columns("a", "b")</code> or the user could perform
<code class="language-plaintext highlighter-rouge">select(col("a"), col("b"))</code>. In the new release, we accept either full expressions in <code class="language-plaintext highlighter-rouge">select()</code>
or strings of the column names. You can mix these as well.</p>

<p>Where before you may have to do an operation like</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_subset</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">),</span> <span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">),</span> <span class="n">f</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">)))</span>
</code></pre></div></div>

<p>You can now simplify this to</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_subset</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="n">f</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">c</span><span class="sh">"</span><span class="p">)))</span>
</code></pre></div></div>

<h3 id="creating-named-structs">Creating named structs</h3>

<p>Creating a <code class="language-plaintext highlighter-rouge">struct</code> with named fields was previously difficult to use and allowed for potential
user errors when specifying the name of each field. Now we have a cleaner interface where the
user passes a list of tuples containing the name of the field and the expression to create.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="nf">named_struct</span><span class="p">([</span>
  <span class="p">(</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">,</span> <span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">a</span><span class="sh">"</span><span class="p">)),</span>
  <span class="p">(</span><span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">,</span> <span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">b</span><span class="sh">"</span><span class="p">))</span>
<span class="p">]))</span>
</code></pre></div></div>

<h2 id="next-steps">Next Steps</h2>

<p>While most of the user facing classes and functions have been exposed, there are a few that require
exposure. Namely the classes in <code class="language-plaintext highlighter-rouge">datafusion.object_store</code> and the logical plans used by
<code class="language-plaintext highlighter-rouge">datafusion.substrait</code>. The team is working on
<a href="https://github.com/apache/datafusion-python/issues/767">these issues</a>.</p>

<p>Additionally, in the next release of DataFusion there have been improvements made to the user-defined
aggregate and window functions to make them easier to use. We plan on
<a href="https://github.com/apache/datafusion-python/issues/780">bringing these enhancements</a> to this project.</p>

<h2 id="thank-you">Thank You</h2>

<p>We would like to thank the following members for their very helpful discussions regarding these
updates: <a href="https://github.com/andygrove">@andygrove</a>, <a href="https://github.com/max-muoto">@max-muoto</a>, <a href="https://github.com/slyons">@slyons</a>, <a href="https://github.com/Throne3d">@Throne3d</a>, <a href="https://github.com/Michael-J-Ward">@Michael-J-Ward</a>, <a href="https://github.com/datapythonista">@datapythonista</a>,
<a href="https://github.com/austin362667">@austin362667</a>, <a href="https://github.com/kylebarron">@kylebarron</a>, <a href="https://github.com/simicd">@simicd</a>. The <a href="https://github.com/apache/datafusion-python/pull/750">primary PR (#750)</a> that includes these updates
had an extensive conversation, leading to a significantly improved end product. Again, thank you
to all who provided input!</p>

<p>We would like to give an special thank you to <a href="https://github.com/3ok">@3ok</a> who created the initial version of the wrapper
definitions. The work they did was time consuming and required exceptional attention to detail. It
provided enormous value to starting this project. Thank you!</p>

<h2 id="get-involved">Get Involved</h2>

<p>The DataFusion Python team is an active and engaging community and we would love
to have you join us and help the project.</p>

<p>Here are some ways to get involved:</p>

<ul>
  <li>
    <p>Learn more by visiting the <a href="https://datafusion.apache.org/python/index.html">DataFusion Python project</a>
page.</p>
  </li>
  <li>
    <p>Try out the project and provide feedback, file issues, and contribute code.</p>
  </li>
</ul>


  </div><a class="u-url" href="/blog/2024/08/20/python-datafusion-40.0.0/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Apache DataFusion Project News &amp; Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Apache DataFusion Project News &amp; Blog</li><li><a class="u-email" href="mailto:dev@datafusion.apache.org">dev@datafusion.apache.org</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/apache"><svg class="svg-icon"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg> <span class="username">apache</span></a></li><li><a href="https://www.twitter.com/ApacheDataFusio"><svg class="svg-icon"><use xlink:href="/blog/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">ApacheDataFusio</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Apache DataFusion is a very fast, extensible query engine for building high-quality  data-centric systems in Rust, using the Apache Arrow in-memory format.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
