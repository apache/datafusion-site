<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1100 383" style="max-width: 100%; height: auto;" role="img" aria-label="DataFusion SQL processing pipeline: SQL String flows through Parser to AST, then SqlToRel (with Extension Planners) to LogicalPlan, then PhysicalPlanner to ExecutionPlan">
  <defs>
    <marker id="arrowhead" markerWidth="8" markerHeight="5.6" refX="7" refY="2.8" orient="auto">
      <polygon points="0 0, 8 2.8, 0 5.6" fill="#94a3b8"/>
    </marker>
    <marker id="arrowhead-rose" markerWidth="8" markerHeight="5.6" refX="7" refY="2.8" orient="auto">
      <polygon points="0 0, 8 2.8, 0 5.6" fill="#c0392b"/>
    </marker>
    <marker id="arrowhead-amber" markerWidth="8" markerHeight="5.6" refX="7" refY="2.8" orient="auto">
      <polygon points="0 0, 8 2.8, 0 5.6" fill="#e67e22"/>
    </marker>
    <marker id="arrowhead-lime" markerWidth="8" markerHeight="5.6" refX="7" refY="2.8" orient="auto">
      <polygon points="0 0, 8 2.8, 0 5.6" fill="#f1c40f"/>
    </marker>
    <marker id="arrowhead-emerald" markerWidth="8" markerHeight="5.6" refX="7" refY="2.8" orient="auto">
      <polygon points="0 0, 8 2.8, 0 5.6" fill="#27ae60"/>
    </marker>
    <marker id="arrowhead-sky" markerWidth="8" markerHeight="5.6" refX="7" refY="2.8" orient="auto">
      <polygon points="0 0, 8 2.8, 0 5.6" fill="#3498db"/>
    </marker>
    <marker id="arrowhead-violet" markerWidth="8" markerHeight="5.6" refX="7" refY="2.8" orient="auto">
      <polygon points="0 0, 8 2.8, 0 5.6" fill="#9b59b6"/>
    </marker>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="2" flood-opacity="0.12"/>
    </filter>
  </defs>

  <!-- White background -->
  <rect x="0" y="0" width="1100" height="383" fill="white"/>

  <!-- Background groupings (drawn first, behind everything) -->
  <rect x="153.75" y="35" width="113.49999999999999" height="200" rx="2" fill="#e4beba" fill-opacity="0.5"/>
  <rect x="286" y="55" width="98" height="180" rx="24" fill="#f1dcc9" fill-opacity="0.5"/>
  <rect x="402.75" y="35" width="182.5" height="250" rx="2" fill="#f3e9bf" fill-opacity="0.5"/>
  <rect x="604" y="55" width="142" height="180" rx="24" fill="#aaddc0" fill-opacity="0.5"/>
  <rect x="764.75" y="35" width="159.5" height="200" rx="2" fill="#d2e4f0" fill-opacity="0.5"/>
  <rect x="943" y="55" width="142" height="180" rx="24" fill="#e3dbe6" fill-opacity="0.5"/>

  <!-- Row 1: Main pipeline -->

  <!-- SQL String (DATA) -->
  <rect id="box-sql-string" x="20" y="60" width="110.00000000000001" height="50" rx="24" fill="#e2e8f0" stroke="#64748b" stroke-width="2" filter="url(#shadow)"/>
  <text id="text-sql-string" x="75" y="90" text-anchor="middle" font-family="ui-monospace, monospace" font-size="14.5" font-weight="600" fill="#334155">SQL String</text>

  <line id="arrow-sql-to-parser" x1="131" y1="85" x2="156.75" y2="85" stroke="#c0392b" stroke-width="2" marker-end="url(#arrowhead-rose)"/>

  <!-- Parser (TRANSFORMER) - Slot 1 -->
  <rect id="box-parser" x="158.75" y="40" width="103.49999999999999" height="90" rx="2" fill="#e4beba" stroke="#c0392b" stroke-width="2" filter="url(#shadow)"/>
  <text id="text-parser-1" x="210.5" y="70" text-anchor="middle" font-family="ui-monospace, monospace" font-size="14.5" font-weight="600" fill="#43140f">Parser</text>
  <text id="text-parser-2" x="210.5" y="88" text-anchor="middle" font-family="system-ui, sans-serif" font-size="13" fill="#7e0d01">(sqlparser-rs)</text>
  <text id="text-parser-3" x="210.5" y="115" text-anchor="middle" font-family="system-ui, sans-serif" font-size="13" font-weight="600" fill="#7e0d01">Wrap DFParser</text>

  <line id="arrow-parser-to-ast" x1="263.25" y1="85" x2="289" y2="85" stroke="#e67e22" stroke-width="2" marker-end="url(#arrowhead-amber)"/>

  <!-- DFParser wrapper box (TRANSFORMER) - Slot 1 -->
  <rect id="box-dfparser" x="158.75" y="179" width="103.49999999999999" height="50" rx="2" fill="#e4beba" stroke="#c0392b" stroke-width="2" filter="url(#shadow)"/>
  <text id="text-dfparser-1" x="210.5" y="202" text-anchor="middle" font-family="ui-monospace, monospace" font-size="14.5" font-weight="600" fill="#43140f">DFParser</text>
  <text id="text-dfparser-2" x="210.5" y="217" text-anchor="middle" font-family="system-ui, sans-serif" font-size="13" fill="#7e0d01">(wrapper)</text>

  <!-- AST (DATA) - Slot 2 -->
  <rect id="box-ast" x="291" y="60" width="88" height="50" rx="24" fill="#f1dcc9" stroke="#e67e22" stroke-width="2" filter="url(#shadow)"/>
  <text id="text-ast-1" x="335" y="82" text-anchor="middle" font-family="ui-monospace, monospace" font-size="14.5" font-weight="600" fill="#64350b">AST</text>
  <text id="text-ast-2" x="335" y="98" text-anchor="middle" font-family="system-ui, sans-serif" font-size="13" fill="#803c00">(Statement)</text>

  <line id="arrow-ast-to-sqltorel" x1="380" y1="85" x2="405.75" y2="85" stroke="#f1c40f" stroke-width="2" marker-end="url(#arrowhead-lime)"/>

  <!-- Custom Statement box (DATA) - Slot 2 -->
  <rect id="box-custom-statement" x="291" y="179" width="88" height="50" rx="24" fill="#f1dcc9" stroke="#e67e22" stroke-width="2" filter="url(#shadow)"/>
  <text id="text-custom-statement-1" x="335" y="199" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14.5" font-weight="600" fill="#64350b">Custom</text>
  <text id="text-custom-statement-2" x="335" y="214" text-anchor="middle" font-family="ui-monospace, monospace" font-size="14.5" font-weight="600" fill="#64350b">Statement</text>

  <!-- Arrow from DFParser to Custom Statement -->
  <line id="arrow-dfparser-to-custom-statement" x1="263.25" y1="204" x2="289" y2="204" stroke="#e67e22" stroke-width="2" marker-end="url(#arrowhead-amber)"/>

  <!-- SqlToRel (TRANSFORMER) - Slot 3 -->
  <rect id="box-sqltorel" x="407.75" y="40" width="172.5" height="90" rx="2" fill="#f3e9bf" stroke="#f1c40f" stroke-width="2" filter="url(#shadow)"/>
  <text id="text-sqltorel-1" x="494" y="70" text-anchor="middle" font-family="ui-monospace, monospace" font-size="14.5" font-weight="600" fill="#614f06">SqlToRel</text>
  <text id="text-sqltorel-2" x="494" y="88" text-anchor="middle" font-family="system-ui, sans-serif" font-size="13" fill="#806600">(AST to Logical)</text>
  <text id="text-sqltorel-3" x="494" y="115" text-anchor="middle" font-family="system-ui, sans-serif" font-size="13" font-weight="600" fill="#806600">Extension Planners</text>

  <line id="arrow-sqltorel-to-logicalplan" x1="581.25" y1="85" x2="607" y2="85" stroke="#27ae60" stroke-width="2" marker-end="url(#arrowhead-emerald)"/>

  <!-- Extension Planners container (TRANSFORMER) - Slot 3 -->
  <rect id="box-extension-planners" x="407.75" y="165" width="172.5" height="115" rx="2" fill="#f3e9bf" stroke="#f1c40f" stroke-width="2" filter="url(#shadow)"/>
  <text id="text-extension-planners-1" x="494" y="183" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14.5" font-weight="600" fill="#614f06">Extension Planners</text>

  <!-- RelationPlanner sub-box (top - produces UserDefinedLogicalNode) -->
  <rect id="box-relation-planner" x="419.25" y="192" width="149.5" height="24" rx="2" fill="#fbf8e9" stroke="#f1c40f" stroke-width="1"/>
  <text id="text-relation-planner" x="494" y="208" text-anchor="middle" font-family="ui-monospace, monospace" font-size="13" font-weight="600" fill="#614f06">RelationPlanner</text>

  <!-- ExprPlanner sub-box -->
  <rect id="box-expr-planner" x="419.25" y="220" width="149.5" height="24" rx="2" fill="#fbf8e9" stroke="#f1c40f" stroke-width="1"/>
  <text id="text-expr-planner" x="494" y="236" text-anchor="middle" font-family="ui-monospace, monospace" font-size="13" font-weight="600" fill="#614f06">ExprPlanner</text>

  <!-- TypePlanner sub-box -->
  <rect id="box-type-planner" x="419.25" y="248" width="149.5" height="24" rx="2" fill="#fbf8e9" stroke="#f1c40f" stroke-width="1"/>
  <text id="text-type-planner" x="494" y="264" text-anchor="middle" font-family="ui-monospace, monospace" font-size="13" font-weight="600" fill="#614f06">TypePlanner</text>

  <!-- LogicalPlan (DATA) - Slot 4 -->
  <rect id="box-logicalplan" x="609" y="60" width="132" height="50" rx="24" fill="#aaddc0" stroke="#27ae60" stroke-width="2" filter="url(#shadow)"/>
  <text id="text-logicalplan" x="675" y="90" text-anchor="middle" font-family="ui-monospace, monospace" font-size="14.5" font-weight="600" fill="#0e3e22">LogicalPlan</text>

  <line id="arrow-logicalplan-to-physicalplanner" x1="742" y1="85" x2="767.75" y2="85" stroke="#3498db" stroke-width="2" marker-end="url(#arrowhead-sky)"/>

  <!-- UserDefinedLogicalNode box (DATA) - Slot 4 -->
  <rect id="box-userdefined-logical" x="609" y="179" width="132" height="50" rx="24" fill="#aaddc0" stroke="#27ae60" stroke-width="2" filter="url(#shadow)"/>
  <text id="text-userdefined-logical-1" x="675" y="199" text-anchor="middle" font-family="ui-monospace, monospace" font-size="14.5" font-weight="600" fill="#0e3e22">UserDefined</text>
  <text id="text-userdefined-logical-2" x="675" y="214" text-anchor="middle" font-family="ui-monospace, monospace" font-size="14.5" font-weight="600" fill="#0e3e22">LogicalNode</text>

  <!-- Arrow from RelationPlanner to UserDefinedLogicalNode -->
  <line id="arrow-relationplanner-to-userdefined" x1="569.75" y1="204" x2="607" y2="204" stroke="#27ae60" stroke-width="2" marker-end="url(#arrowhead-emerald)"/>

  <!-- PhysicalPlanner (TRANSFORMER) - Slot 5 -->
  <rect id="box-physicalplanner" x="769.75" y="40" width="149.5" height="90" rx="2" fill="#d2e4f0" stroke="#3498db" stroke-width="2" filter="url(#shadow)"/>
  <text id="text-physicalplanner-1" x="844.5" y="70" text-anchor="middle" font-family="ui-monospace, monospace" font-size="14.5" font-weight="600" fill="#124364">PhysicalPlanner</text>
  <text id="text-physicalplanner-2" x="844.5" y="88" text-anchor="middle" font-family="system-ui, sans-serif" font-size="13" fill="#004c80">(Logical to Physical)</text>
  <text id="text-physicalplanner-3" x="844.5" y="115" text-anchor="middle" font-family="system-ui, sans-serif" font-size="13" font-weight="600" fill="#004c80">ExtensionPlanner</text>

  <line id="arrow-physicalplanner-to-executionplan" x1="920.25" y1="85" x2="946" y2="85" stroke="#9b59b6" stroke-width="2" marker-end="url(#arrowhead-violet)"/>

  <!-- ExtensionPlanner box (TRANSFORMER) - Slot 5 -->
  <rect id="box-extensionplanner" x="769.75" y="179" width="149.5" height="50" rx="2" fill="#d2e4f0" stroke="#3498db" stroke-width="2" filter="url(#shadow)"/>
  <text id="text-extensionplanner-1" x="844.5" y="202" text-anchor="middle" font-family="ui-monospace, monospace" font-size="14.5" font-weight="600" fill="#124364">ExtensionPlanner</text>
  <text id="text-extensionplanner-2" x="844.5" y="217" text-anchor="middle" font-family="system-ui, sans-serif" font-size="13" fill="#004c80">(trait)</text>

  <!-- ExecutionPlan (DATA) - Slot 6 -->
  <rect id="box-executionplan" x="948" y="60" width="132" height="50" rx="24" fill="#e3dbe6" stroke="#9b59b6" stroke-width="2" filter="url(#shadow)"/>
  <text id="text-executionplan" x="1014" y="90" text-anchor="middle" font-family="ui-monospace, monospace" font-size="14.5" font-weight="600" fill="#452452">ExecutionPlan</text>

  <!-- Custom ExecutionPlan box (DATA) - Slot 6 -->
  <rect id="box-custom-execution" x="948" y="179" width="132" height="50" rx="24" fill="#e3dbe6" stroke="#9b59b6" stroke-width="2" filter="url(#shadow)"/>
  <text id="text-custom-execution-1" x="1014" y="199" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14.5" font-weight="600" fill="#452452">Custom</text>
  <text id="text-custom-execution-2" x="1014" y="214" text-anchor="middle" font-family="ui-monospace, monospace" font-size="14.5" font-weight="600" fill="#452452">ExecutionPlan</text>

  <!-- Arrow from ExtensionPlanner to Custom ExecutionPlan -->
  <line id="arrow-extensionplanner-to-custom-execution" x1="920.25" y1="204" x2="946" y2="204" stroke="#9b59b6" stroke-width="2" marker-end="url(#arrowhead-violet)"/>

  <!-- Legend at bottom (aligned with transformers: Parser@155, SqlToRel@395, PhysicalPlanner@735) -->
  <rect x="20" y="313" width="1060" height="55" rx="6" fill="#f8fafc" stroke="#e2e8f0" stroke-width="1"/>
  <text x="40" y="338" font-family="system-ui, sans-serif" font-size="15.0" font-weight="600" fill="#475569">Hook Points:</text>
  <rect x="158.75" y="327" width="12" height="12" rx="2" fill="#e4beba" stroke="#c0392b" stroke-width="1"/>
  <text id="legend-text-1" x="176.75" y="337" font-family="system-ui, sans-serif" font-size="14" fill="#475569">Parser (wrap DFParser)</text>
  <rect x="407.75" y="327" width="12" height="12" rx="2" fill="#f3e9bf" stroke="#f1c40f" stroke-width="1"/>
  <text id="legend-text-2" x="425.75" y="337" font-family="system-ui, sans-serif" font-size="14" fill="#475569">SQL Planning (operators, types, relations)</text>
  <rect x="769.75" y="327" width="12" height="12" rx="2" fill="#d2e4f0" stroke="#3498db" stroke-width="1"/>
  <text id="legend-text-3" x="787.75" y="337" font-family="system-ui, sans-serif" font-size="14" fill="#475569">Physical Planning (custom execution)</text>
  <text id="legend-text-4" x="158.75" y="355" font-family="system-ui, sans-serif" font-size="14" fill="#64748b">Parse errors: wrap parser</text>
  <text id="legend-text-5" x="407.75" y="355" font-family="system-ui, sans-serif" font-size="14" fill="#64748b">Plan errors: implement planners</text>
  <text id="legend-text-6" x="769.75" y="355" font-family="system-ui, sans-serif" font-size="14" fill="#64748b">Execute errors: implement ExtensionPlanner</text>
</svg>