---
layout: post
title: Apache DataFusion 46.0.0 Released
date: 2025-03-24
author: Oznur Hanci and Berkay Sahin on behalf of the PMC
categories: [release]
---
<!--
{% comment %}
Licensed to the Apache Software Foundation (ASF) under one or more
contributor license agreements.  See the NOTICE file distributed with
this work for additional information regarding copyright ownership.
The ASF licenses this file to you under the Apache License, Version 2.0
(the "License"); you may not use this file except in compliance with
the License.  You may obtain a copy of the License at
http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
{% endcomment %}
-->

Weâ€™re excited to announce the release ofÂ **Apache DataFusion 46.0.0**! This new version represents a significant milestone for the project, packing in a wide range of improvements and fixes. You can find the complete details in theÂ full [changelog](https://github.com/apache/datafusion/blob/branch-46/dev/changelog/46.0.0.md). Weâ€™ll highlight the most important changes below and guide you through upgrading.

## Breaking Changes

DataFusion 46.0.0 brings a fewÂ **breaking changes**Â that may require adjustments to your code:

- [Unified DataSourceExec Execution Plan](https://github.com/apache/datafusion/pull/14224#)**:**Â DataFusion 46.0.0 introduces a major refactor of scan operators. The separate file-format-specific execution plan nodes (`ParquetExec`,Â `CsvExec`,Â `JsonExec`,Â `AvroExec`, etc.) have beenÂ **deprecated and merged into a single**Â `DataSourceExec`Â plan. Format-specific logic is now encapsulated in newÂ `DataSource`Â andÂ `FileSource`Â traits. This change simplifies the execution model, but if you have code that directly references the old plan nodes, youâ€™ll need to update it to useÂ `DataSourceExec`Â (see theÂ [Upgrade Guide](https://datafusion.apache.org/library-user-guide/upgrading.html)Â for examples of the new API).
- [**Error Handling Improvements](https://github.com/apache/arrow-datafusion/issues/7360#:~:text=2) (`DataFusionError::Collection`):**Â We have begun overhauling DataFusionâ€™s error handling. In this release, a new error variantÂ `DataFusionError::Collection`Â (and related mechanisms) has been introduced to aggregate multiple errors into one. This is part of a broader effort to provide richer error context and reduce internal panics. As a result, some error types or messages have changed. Downstream code that matches on specificÂ `DataFusionError`Â variants might need adjustment.

## Highlighted New Features

### Improved Diagnostics

DataFusion 46.0.0 introduces a newÂ [**SQL Diagnostics framework**](https://github.com/apache/datafusion/issues/14429)Â to make error messages more understandable. This comes in the form of newÂ `Diagnostic`Â andÂ `DiagnosticEntry`Â types, which allow the system to attach rich context (like source query text spans) to error messages. In practical terms, certain planner errors will now point to the exact location in your SQL query that caused the issue. 

For example, if you reference an unknown table or miss a column in `GROUP BY` the error message will include the query snippet causing the error. These diagnostics are meant for end-users of applications built on DataFusion, providing clearer messages instead of generic errors. Currently, diagnostics cover unresolved table/column references, missing `GROUP BY`columns, ambiguous references, wrong number of UNION columns, type mismatches, and a few others. Future releases will extend this to more error types. This feature should greatly ease debugging of complex SQL by pinpointing errors directly in the query text. Thanks to [@eliaperantoni](https://github.com/eliaperantoni).

### UnifiedÂ `DataSourceExec`Â for Table Providers

As mentioned, DataFusion now uses a unifiedÂ `DataSourceExec`Â for reading tables, which is both a breaking change and a feature.Â **Why is this exciting?**Â Because it simplifies how custom table providers are integrated and optimized. With one execution plan to handle all data sources, the optimizer can treat file scans uniformly and push down filters/limits more consistently. The newÂ `DataSourceExec`Â is paired with aÂ `DataSource`Â trait that encapsulates format-specific behaviors (Parquet, CSV, JSON, Avro, etc.) in a pluggable way.

All built-in sources (Parquet, CSV, Avro, Arrow, JSON, etc.) have been migrated to this framework. This unification makes the codebase cleaner and sets the stage for future enhancements (like consistent metadata handling and limit pushdown across all formats). Check out PR [#14224](https://github.com/apache/datafusion/pull/14224) for design details, thanks to [@mertak-synnada](https://github.com/mertak-synnada) and [@ozankabak](https://github.com/ozankabak).

### FFI Support for Scalar UDFs

DataFusionâ€™s Foreign Function Interface (FFI) has been extended to supportÂ [**user-defined scalar functions**](https://github.com/apache/datafusion/pull/14579)Â defined in external languages. In 46.0.0, you can now expose a custom scalar UDF through the FFI layer and use it in DataFusion as if it were built-in. This is particularly exciting for the **Python bindings** and other language integrations â€“ it means you could define a function in Python (or C, etc.) and register it with DataFusionâ€™s Rust core via the FFI crate. Thanks, [@timsaucer](https://github.com/timsaucer)!

### Distribution Framework

This release, thanks mainly to [@Fly-Style](https://github.com/Fly-Style) with contributions from [@ozankabak](https://github.com/ozankabak) and [@berkaysynnada](https://github.com/berkaysynnada), includes the initial pieces of aÂ [**redesigned statistics framework](https://github.com/apache/datafusion/pull/14699).** DataFusionâ€™s optimizer can now represent column data distributions using a newÂ `Distribution`Â enum, instead of the old precision or range estimations. The supported distribution types currently includeÂ **Uniform, Gaussian (normal), Exponential, Bernoulli**, and anÂ **Unknown**Â catch-all.

For example, if a filter expression is applied to a column with a known uniform distribution range, the optimizer can propagate that to estimate result selectivity more accurately. Similarly, comparisons (=, >, etc.) on columns yield Bernoulli distributions (true/false probabilities) in this model

This is a foundational change: the immediate user-visible effect is limited (the optimizer wonâ€™t yet magically become a genius), but it lays groundwork for more advanced query planning in the future. Over time, as these `Distribution`'s get integrated, DataFusion will be able to make smarter decisions like more aggressive parquet pruning, better join orderings, and so on based on data distribution assumptions. Note that for now, the framework is in place and being hooked up (with basic support for propagation of Uniform and handling of some combos), but itâ€™s not fully exploited yet. Think of this as an investment in performance improvements down the line.

### Aggregate Monotonicity and Window Ordering

DataFusion 46.0.0 adds a new concept ofÂ [set](https://github.com/apache/datafusion/pull/14271#)[-monotonicity](https://github.com/apache/datafusion/blob/5210a2bac32e43dc7bf6e7e6000cdeaf2833c06e/datafusion/expr/src/udaf.rs#L1090) for certain transformations, which helps avoid unnecessary sort operations. In particular, the planner now understands when a **window function preserves ordering** of data (or when a sorted input remains sorted after the operation). For example, a window-aggregate likeÂ `MAX`Â on a column that is not ordered can be known to be still ordered. PR [#14271](https://github.com/apache/datafusion/pull/14271) introduced a â€œset-monotonicityâ€ property for window functions, and a follow-up PR [#14813](https://github.com/apache/datafusion/pull/14813) refined the handling of sort order in window frames. Huge thanks to [@berkaysynnada](https://github.com/berkaysynnada) and [@mertak-synnada](https://github.com/mertak-synnada) for this feature.

## Performance Improvements

DataFusion 46.0.0 comes with a slew of performance enhancements across the board. Here are some of the noteworthy optimizations in this release:

- **FasterÂ `median()`Â (no grouping):**Â TheÂ `median()`Â aggregate function got a special fast path when used without aÂ `GROUP BY`. By optimizing its accumulator, median calculation is aboutÂ **2Ã— faster**Â in the single-group case. If you useÂ `MEDIAN()`Â on large datasets (especially as a single value), you should notice reduced query times (PR [#14399](https://github.com/apache/datafusion/pull/14399) by [@2010YOUY01](https://github.com/2010YOUY01)).
- **OptimizedÂ `FIRST_VALUE`/`LAST_VALUE`:**Â TheÂ `FIRST_VALUE`Â andÂ `LAST_VALUE`Â window functions have been improved by avoiding an internal sort of rows. Instead of sorting each partition, the implementation now uses a direct approach to pick the first/last element. This yieldsÂ **10â€“100% performance improvement**Â for these functions, depending on the scenario. Queries usingÂ `FIRST_VALUE(...) OVER (PARTITION BY ... ORDER BY ...)`Â will run faster, especially when partitions are large (PR [#14402](https://github.com/apache/datafusion/pull/14402) by [@blaginin](https://github.com/blaginin)).
- **`repeat()`Â String Function Boost:**Â Repeating strings is now more efficient â€“ theÂ `repeat(text, n)`Â function was optimized by aboutÂ **50%**. This was achieved by reducing allocations and using a more efficient concatenation strategy. If you generate large repeated strings in queries, this can cut the time nearly in half (PR [#14697](https://github.com/apache/datafusion/pull/14697) by [@zjregee](https://github.com/zjregee)).
- **Ultra-fastÂ `uuid()`Â UDF:**Â TheÂ `uuid()`Â function (which generates random UUID strings) received a major speed-up. Itâ€™s now roughlyÂ **40Ã— faster**Â than before! The new implementation avoids unnecessary string copying and uses a more direct conversion to hex, making bulk UUID generation far more practical (PR [#14675](https://github.com/apache/datafusion/pull/14675) by [@simonvandel](https://github.com/simonvandel)).
- **AcceleratedÂ `chr()`Â andÂ `to_hex()`:**Â Several scalar functions have been micro-optimized. TheÂ `chr()`Â function (which returns the character for a given ASCII code) is aboutÂ **4Ã— faster**Â now, and theÂ `to_hex()`Â function (which converts numbers to hex string) is roughlyÂ **2Ã— faster**. These improvements may be most noticeable in tight loops or when these functions are applied to large arrays of values (PR [#14700](https://github.com/apache/datafusion/pull/14700) forÂ `chr`, [#14686](https://github.com/apache/datafusion/pull/14686) forÂ `to_hex` by [@simonvandel](https://github.com/simonvandel)).
- **No More RowConverter in Grouped Ordering:**Â We removed an inefficient step in theÂ *partial grouping*Â algorithm. TheÂ `GroupOrderingPartial`Â operator no longer converts data to â€œrow formatâ€ for each batch (viaÂ `RowConverter`). Instead, it uses a direct arrow-based approach to detect sort key changes. This eliminated overhead and yields a nice speedup for certain aggregation queries. (PR [#14566](https://github.com/apache/datafusion/pull/14566) by [@ctsk](https://github.com/ctsk)).
- **Predicate Pruning forÂ `NOT LIKE`:**Â DataFusionâ€™s parquet reader can now prune row groups usingÂ `NOT LIKE`Â filters, similar to how it handlesÂ `LIKE`. This means if you have a filter such asÂ `column NOT LIKE 'prefix%'`, DataFusion can use min/max statistics to skip reading files/parts that can be determined to either entirely match or not match the predicate. In particular, a pattern likeÂ `NOT LIKE 'X%'`Â can skip data ranges that definitely start with "X". While a niche case, it contributes to query efficiency in those scenarios (PR [#14567](https://github.com/apache/datafusion/pull/14567) by [@UBarney](https://github.com/UBarney)).
- **`UNION [ALL|DISTINCT] BY NAME`Â Support:**Â While not a pure speed optimization, itâ€™s worth noting we added support forÂ `UNION BY NAME`Â (bothÂ `UNION BY NAME`Â which is distinct by default, andÂ `UNION ALL BY NAME`). This allows combining two result sets by aligning columns by name instead of by position, which can save you from manualÂ `SELECT`Â reordering and thus simplify query logic. The new logical plan builder functionsÂ `union_by_name()`andÂ `union_by_name_distinct()`Â correspond to these operations. This feature, inspired by systems like Spark and DuckDB, makes it easier to union heterogenous datasets. (PR [#14538](https://github.com/apache/datafusion/pull/14538) by [@rkrishn7](https://github.com/rkrishn7))
- **NewÂ `range()`Â Table Function:**Â We introduced a built-in table-valued functionÂ `range()`Â for generating sequences of numbers. Similar to Sparkâ€™sÂ `range()`Â or PostgreSQLâ€™sÂ `generate_series`, this function can produce a series of integer values which is useful for testing, recursive queries, or generating surrogate keys. For example,Â `SELECT * FROM range(0, 100, 1)`Â would produce rows from 0 to 99. This function is implemented in Rust for efficiency (leveraging the same mechanism asÂ `generate_series`) and avoids needing a separate source of sequence data. Itâ€™s a handy addition for ETL and data generation tasks (PR [#14830](https://github.com/apache/datafusion/pull/14830) by [@simonvandel](https://github.com/simonvandel)).

## Google Summer of Code 2025

Another exciting development:Â **Apache DataFusion has been accepted as a mentoring organization for Google Summer of Code (GSoC) 2025**! ğŸ‰ This means that this summer, students from around the world will have the opportunity to contribute to DataFusion under the guidance of our committers. We have put together [a list of project ideas](https://datafusion.apache.org/contributor-guide/gsoc_project_ideas.html) that candidates can choose from. 

If youâ€™re interested, check out ourÂ [GSoC Application Guidelines](https://datafusion.apache.org/contributor-guide/gsoc_application_guidelines.html). We encourage students to reach out, discuss ideas with us, and apply. 

## Upgrade Guide and Changelog

Upgrading to 46.0.0 should be straightforward for most users, but do review theÂ [Upgrade Guide for DataFusion 46.0.0](https://datafusion.apache.org/library-user-guide/upgrading.html)Â for detailed steps and code changes. The upgrade guide covers the breaking changes mentioned (like replacing old exec nodes withÂ `DataSourceExec`, updating UDF invocation toÂ `invoke_with_args`, etc.) and provides code snippets to help with the transition. For a comprehensive list of all changes, please refer to theÂ **changelog**Â for 46.0.0 (linked above and in the repository). The changelog enumerates every merged PR in this release, including many smaller fixes and improvements that we couldnâ€™t cover in this post.

## Get Involved

Apache DataFusion is an open-source project, and we welcome involvement from anyone interested. Now is a great time to take 46.0.0 for a spin: try it out on your workloads, and let us know if you encounter any issues or have suggestions. You can report bugs or request features on ourÂ GitHub issue tracker, or better yet, submit a pull request. Join our community discussions â€“ whether you have questions, want to share how youâ€™re using DataFusion, or are looking to contribute, weâ€™d love to hear from you. A list of open issues suitable for beginners isÂ [here](https://github.com/apache/arrow-datafusion/issues?q=is%3Aissue+is%3Aopen+label%3A%22good+first+issue%22)Â and you can find how to reach us on theÂ [communication doc](https://datafusion.apache.org/contributor-guide/communication.html).

Happy querying!