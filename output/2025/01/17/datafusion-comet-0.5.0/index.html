<!doctype html>
<html class="no-js" lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apache DataFusion Comet 0.5.0 Release - Apache DataFusion Blog</title>
<link href="/blog/css/bootstrap.min.css" rel="stylesheet">
<link href="/blog/css/fontawesome.all.min.css" rel="stylesheet">
<link href="/blog/css/headerlink.css" rel="stylesheet">
<link href="/blog/highlight/default.min.css" rel="stylesheet">
<link href="/blog/css/app.css" rel="stylesheet">
<script src="/blog/highlight/highlight.js"></script>
<script>hljs.highlightAll();</script>  </head>
  <body class="d-flex flex-column h-100">
  <main class="flex-shrink-0">
<!-- nav bar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark" aria-label="Fifth navbar example">
    <div class="container-fluid">
        <a class="navbar-brand" href="/blog/"><img src="/blog/images/logo_original4x.png" style="height: 32px;"/> Apache DataFusion Blog</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarADP" aria-controls="navbarADP" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarADP">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link" href="/blog/about.html">About</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/blog/feed.xml">RSS</a>
                </li>
            </ul>
        </div>
    </div>
</nav>    
<!-- article contents -->
<div id="contents">
  <div class="bg-white p-4 p-md-5 rounded">
    <div class="row justify-content-center">
      <div class="col-12 col-md-8 main-content">
        <h1>
          Apache DataFusion Comet 0.5.0 Release
        </h1>
        <p>Posted on: Fri 17 January 2025 by pmc</p>

        <aside class="toc-container d-md-none mb-2">
          <div class="toc"><span class="toctitle">Contents</span><ul>
<li><a href="#release-highlights">Release Highlights</a><ul>
<li><a href="#performance">Performance</a></li>
<li><a href="#shuffle-improvements">Shuffle Improvements</a></li>
<li><a href="#memory-management">Memory Management</a></li>
<li><a href="#spark-sql-metrics">Spark SQL Metrics</a></li>
<li><a href="#crate-reorganization">Crate Reorganization</a></li>
</ul>
</li>
<li><a href="#update-on-complex-type-support">Update on Complex Type Support</a></li>
<li><a href="#getting-involved">Getting Involved</a></li>
</ul>
</div>
        </aside>

        <!--
{% comment %}
Licensed to the Apache Software Foundation (ASF) under one or more
contributor license agreements.  See the NOTICE file distributed with
this work for additional information regarding copyright ownership.
The ASF licenses this file to you under the Apache License, Version 2.0
(the "License"); you may not use this file except in compliance with
the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
{% endcomment %}
-->

<p>The Apache DataFusion PMC is pleased to announce version 0.5.0 of the <a href="https://datafusion.apache.org/comet/">Comet</a> subproject.</p>
<p>Comet is an accelerator for Apache Spark that translates Spark physical plans to DataFusion physical plans for
improved performance and efficiency without requiring any code changes.</p>
<p>Comet runs on commodity hardware and aims to provide 100% compatibility with Apache Spark. Any operators or
expressions that are not fully compatible will fall back to Spark unless explicitly enabled by the user. Refer
to the <a href="https://datafusion.apache.org/comet/user-guide/compatibility.html">compatibility guide</a> for more information.</p>
<p>This release covers approximately 8 weeks of development work and is the result of merging 69 PRs from 15
contributors. See the <a href="https://github.com/apache/datafusion-comet/blob/main/dev/changelog/0.5.0.md">change log</a> for more information.</p>
<h2 id="release-highlights">Release Highlights<a class="headerlink" href="#release-highlights" title="Permanent link">¶</a></h2>
<h3 id="performance">Performance<a class="headerlink" href="#performance" title="Permanent link">¶</a></h3>
<p>Comet 0.5.0 achieves a 1.9x speedup for single-node TPC-H @ 100 GB, an improvement from 1.7x in the previous release.</p>
<p><img alt="Chart showing TPC-H benchmark results for Comet 0.5.0" class="img-responsive" src="/blog/images/comet-0.5.0/tpch_allqueries.png" width="100%"/></p>
<p><img alt="Chart showing TPC-H benchmark results for Comet 0.5.0" class="img-responsive" src="/blog/images/comet-0.5.0/tpch_queries_compare.png" width="100%"/></p>
<p>More benchmarking results can be found in the <a href="https://datafusion.apache.org/comet/contributor-guide/benchmarking.html">Comet Benchmarking Guide</a>.</p>
<h3 id="shuffle-improvements">Shuffle Improvements<a class="headerlink" href="#shuffle-improvements" title="Permanent link">¶</a></h3>
<p>Comet now supports multiple compression algorithms for compressing shuffle files. Previously, only ZSTD was supported
but Comet now also supports LZ4 and Snappy. The default is now LZ4, which matches the default in Spark. ZSTD may be
a better choice when the compression ratio is more important than CPU overhead.</p>
<p>Previously, Comet used Arrow IPC to encode record batches into shuffle files. Although Arrow IPC is a good
general-purpose framework for serializing Arrow record batches, we found that we could get better performance using
a custom serialization approach optimized for Comet. One optimization is that the schema is encoded once per shuffle
operation rather than once per batch. There are some planned performance improvements in the Rust implementation of
Arrow IPC and Comet may switch back to Arrow IPC in the future.</p>
<p>Comet provides two shuffle implementations. Comet native shuffle is the fastest and performs repartitioning in
native code. Comet columnar shuffle delegates to Spark to perform repartitioning and is used in cases where native
shuffle is not supported, such as with <code>RangePartitioning</code>. Comet generally tries to use native shuffle first, then
columnar shuffle, and finally falls back to Spark if neither is supported. There was a bug in previous releases
where Comet would sometimes fall back to Spark shuffle if native shuffle was not supported and missed opportunities
to use columnar shuffle. This bug was fixed in this release but currently requires the configuration setting
<code>spark.comet.exec.shuffle.fallbackToColumnar=true</code>. This will be enabled by default in the next release.</p>
<h3 id="memory-management">Memory Management<a class="headerlink" href="#memory-management" title="Permanent link">¶</a></h3>
<p>Comet 0.4.0 required Spark to be configured to use off-heap memory. In this release it is no longer required and
there are multiple options for configuring Comet to use on-heap memory instead. More details are available in the
<a href="https://datafusion.apache.org/comet/user-guide/tuning.html">Comet Tuning Guide</a>.</p>
<h3 id="spark-sql-metrics">Spark SQL Metrics<a class="headerlink" href="#spark-sql-metrics" title="Permanent link">¶</a></h3>
<p>Comet now provides detailed metrics for native shuffle, showing time for repartitioning, encoding and compressing,
and writing to disk.</p>
<h3 id="crate-reorganization">Crate Reorganization<a class="headerlink" href="#crate-reorganization" title="Permanent link">¶</a></h3>
<p>One of the goals of the Comet project is to make Spark-compatible functionality available to other projects that
are based on DataFusion. In this release, many implementations of Spark-compatible expressions were moved from the
unpublished <code>datafusion-comet</code> crate, which provides the native part of the Spark plugin, into the
<code>datafusion-comet-spark-expr</code> crate. There is also ongoing work to reorganize this crate to move expressions into
subfolders named after the group name that Spark uses to organize expressions. For example, there are now subfolders
named <code>agg_funcs</code>, <code>datetime_funcs</code>, <code>hash_funcs</code>, and so on.</p>
<h2 id="update-on-complex-type-support">Update on Complex Type Support<a class="headerlink" href="#update-on-complex-type-support" title="Permanent link">¶</a></h2>
<p>Good progress has been made with proof-of-concept work using DataFusion’s <code>ParquetExec</code>, which has the advantage of
supporting complex types. This work is available on the <code>comet-parquet-exec</code> branch, and the current focus is on
fixing test regressions, particularly regarding timestamp conversion issues.</p>
<h2 id="getting-involved">Getting Involved<a class="headerlink" href="#getting-involved" title="Permanent link">¶</a></h2>
<p>The Comet project welcomes new contributors. We use the same <a href="https://datafusion.apache.org/contributor-guide/communication.html#slack-and-discord">Slack and Discord</a> channels as the main DataFusion
project and have a weekly <a href="https://docs.google.com/document/d/1NBpkIAuU7O9h8Br5CbFksDhX-L9TyO9wmGLPMe0Plc8/edit?usp=sharing">DataFusion video call</a>.</p>
<p>The easiest way to get involved is to test Comet with your current Spark jobs and file issues for any bugs or
performance regressions that you find. See the <a href="https://datafusion.apache.org/comet/user-guide/installation.html">Getting Started</a> guide for instructions on downloading and installing
Comet.</p>
<p>There are also many <a href="https://github.com/apache/datafusion-comet/contribute">good first issues</a> waiting for contributions.</p>

<!--
  Comments Section
  Loaded only after explicit visitor consent to comply with ASF policy.
-->

<div id="comments">
  <hr>
  <h3>Comments</h3>

  <!-- Local loader script -->
  <script src="/content/js/giscus-consent.js" defer></script>

  <!-- Consent UI -->
  <div id="giscus-consent">
    <p>
        We use <a href="https://giscus.app/">Giscus</a> for comments, powered by GitHub Discussions.
        To respect your privacy, Giscus and comments will load only if you click "Show Comments"
    </p>

    <div class="consent-actions">
      <button id="giscus-load" type="button">Show Comments</button>
      <button id="giscus-revoke" type="button" hidden>Hide Comments</button>
    </div>

    <noscript>JavaScript is required to load comments from Giscus.</noscript>
  </div>

  <!-- Container where Giscus will render -->
  <div id="comment-thread"></div>
</div>      </div>
      <aside class="toc-container d-none d-md-block col-md-4 col-xl-3 ms-xl-2">
        <div class="toc"><span class="toctitle">Contents</span><ul>
<li><a href="#release-highlights">Release Highlights</a><ul>
<li><a href="#performance">Performance</a></li>
<li><a href="#shuffle-improvements">Shuffle Improvements</a></li>
<li><a href="#memory-management">Memory Management</a></li>
<li><a href="#spark-sql-metrics">Spark SQL Metrics</a></li>
<li><a href="#crate-reorganization">Crate Reorganization</a></li>
</ul>
</li>
<li><a href="#update-on-complex-type-support">Update on Complex Type Support</a></li>
<li><a href="#getting-involved">Getting Involved</a></li>
</ul>
</div>
      </aside>
    </div>
  </div>
</div>    
    <!-- footer -->
    <div class="row g-0">
      <div class="col-12">
        <p style="font-style: italic; font-size: 0.8rem; text-align: center;">
          Copyright 2026, <a href="https://www.apache.org/">The Apache Software Foundation</a>, Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.<br/>
          Apache&reg; and the Apache feather logo are trademarks of The Apache Software Foundation.
        </p>
      </div>
    </div>
    <script src="/blog/js/bootstrap.bundle.min.js"></script>  </main>
  </body>
</html>
